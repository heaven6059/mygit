<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yougou.logistics.city.dal.database.ConContentMapper" >
  
  <resultMap id="BaseResultMap" type="com.yougou.logistics.city.common.model.ConContent" >
    <id column="LOCNO" property="locno" jdbcType="VARCHAR" />
    <id column="CELL_NO" property="cellNo" jdbcType="VARCHAR" />
    <id column="CELL_ID" property="cellId" jdbcType="DECIMAL" />
    <result column="OWNER_NO" property="ownerNo" jdbcType="VARCHAR" />
    <result column="CONTAINER_NO" property="containerNo" jdbcType="VARCHAR" />
    <result column="ITEM_NO" property="itemNo" jdbcType="VARCHAR" />
    <result column="ITEM_ID" property="itemId" jdbcType="DECIMAL" />
    <result column="PACK_QTY" property="packQty" jdbcType="DECIMAL" />
    <result column="QTY" property="qty" jdbcType="DECIMAL" />
    <result column="OUTSTOCK_QTY" property="outstockQty" jdbcType="DECIMAL" />
    <result column="INSTOCK_QTY" property="instockQty" jdbcType="DECIMAL" />
    <result column="UNUSUAL_QTY" property="unusualQty" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="FLAG" property="flag" jdbcType="VARCHAR" />
    <result column="INSTOCK_TYPE" property="instockType" jdbcType="CHAR" />
    <result column="HM_MANUAL_FLAG" property="hmManualFlag" jdbcType="VARCHAR" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATETM" property="createtm" jdbcType="TIMESTAMP" />
    <result column="EDITOR" property="editor" jdbcType="VARCHAR" />
    <result column="EDITTM" property="edittm" jdbcType="TIMESTAMP" />
    <result column="LABEL_NO" property="labelNo" jdbcType="VARCHAR" />
    <result column="STOCK_TYPE" property="stockType" jdbcType="VARCHAR" />
    <result column="STOCK_VALUE" property="stockValue" jdbcType="VARCHAR" />
    <result column="TASK_NO" property="taskNo" jdbcType="VARCHAR" />
    <result column="BARCODE" property="barcode" jdbcType="VARCHAR" />
    <result column="ITEM_TYPE" property="itemType" jdbcType="VARCHAR" />
    <result column="QUALITY" property="quality" jdbcType="VARCHAR" />
    <result column="SUPPLIER_NO" property="supplierNo" jdbcType="VARCHAR" />
    
  </resultMap>
  
  <resultMap id="BaseResultMap2" type="com.yougou.logistics.city.common.dto.ConContentDto" >
    <result column="LOCNO" property="locno" jdbcType="VARCHAR" />
    <result column="CELL_NO" property="cellNo" jdbcType="VARCHAR" />
    <result column="CELL_ID" property="cellId" jdbcType="DECIMAL" />
    <result column="OWNER_NO" property="ownerNo" jdbcType="VARCHAR" />
    <result column="CONTAINER_NO" property="containerNo" jdbcType="VARCHAR" />
    <result column="ITEM_NO" property="itemNo" jdbcType="VARCHAR" />
    <result column="ITEM_ID" property="itemId" jdbcType="DECIMAL" />
    <result column="PACK_QTY" property="packQty" jdbcType="DECIMAL" />
    <result column="QTY" property="qty" jdbcType="DECIMAL" />
    <result column="OUTSTOCK_QTY" property="outstockQty" jdbcType="DECIMAL" />
    <result column="INSTOCK_QTY" property="instockQty" jdbcType="DECIMAL" />
    <result column="UNUSUAL_QTY" property="unusualQty" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="FLAG" property="flag" jdbcType="VARCHAR" />
    <result column="INSTOCK_TYPE" property="instockType" jdbcType="CHAR" />
    <result column="HM_MANUAL_FLAG" property="hmManualFlag" jdbcType="VARCHAR" />
    <result column="CREATOR" property="creator" jdbcType="VARCHAR" />
    <result column="CREATETM" property="createtm" jdbcType="TIMESTAMP" />
    <result column="EDITOR" property="editor" jdbcType="VARCHAR" />
    <result column="EDITTM" property="edittm" jdbcType="TIMESTAMP" />
    <result column="LABEL_NO" property="labelNo" jdbcType="VARCHAR" />
    <result column="STOCK_TYPE" property="stockType" jdbcType="VARCHAR" />
    <result column="STOCK_VALUE" property="stockValue" jdbcType="VARCHAR" />
    <result column="TASK_NO" property="taskNo" jdbcType="VARCHAR" />
    <result column="ITEM_NAME" property="itemName" jdbcType="VARCHAR" />
    <result column="COLOR_NO" property="colorNo" jdbcType="VARCHAR" />
    <result column="COLOR_NAME" property="colorName" jdbcType="VARCHAR" />
    <result column="STYLE_NO" property="styleNo" jdbcType="VARCHAR" />
    <result column="SIZE_NO" property="sizeNo" jdbcType="VARCHAR" />
    <result column="sumQty" property="sumQty" jdbcType="DECIMAL" />
    <result column="sumPlanQty" property="sumPlanQty" jdbcType="DECIMAL" />
    <result column="BARCODE" property="barcode" jdbcType="VARCHAR" />
    <result column="ITEM_TYPE" property="itemType" jdbcType="VARCHAR" />
    <result column="QUALITY" property="quality" jdbcType="VARCHAR" />
    <result column="QUALITY_NAME" property="qualityName" jdbcType="VARCHAR" />
    <result column="SUPPLIER_NO" property="supplierNo" jdbcType="VARCHAR" />
    <result column="sysNo" property="sysNo" jdbcType="VARCHAR" />
    <result column="size_kind" property="sizeKind" jdbcType="VARCHAR" />
    <result column="brand_no" property="brandNo" jdbcType="VARCHAR" />
    <result column="brand_name" property="brandName" jdbcType="VARCHAR" />
    <result column="sale_price" property="salePrice" jdbcType="DECIMAL" />
    <result column="total_qty" property="totalQty" jdbcType="DECIMAL" />
    <result column="years" property="years" jdbcType="VARCHAR" />
    <result column="years_name" property="yearsName" jdbcType="VARCHAR" />
    <result column="season" property="season" jdbcType="VARCHAR" />
    <result column="season_name" property="seasonName" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="VARCHAR" />
    <result column="gender_name" property="genderName" jdbcType="VARCHAR" />
    <result column="cate_no" property="cateNo" jdbcType="VARCHAR" />
    <result column="cate_name" property="cateName" jdbcType="VARCHAR" />
  </resultMap>
  
   <sql id="selectViewColumn" >
    v.locno,v.owner_no,v.cell_no,v.item_no,v.item_type,
    v.quality,v.qty,v.instock_qty,v.outstock_qty,v.pack_qty,
	v.status,v.flag,v.hm_manual_flag,v.size_no,v.barcode,i.brand_no,
	v.cell_id 
  </sql>
  
  <sql id="Base_Column_List" >
    *
  </sql>
  <sql id="condition" >
    <if test="null!=params" >
      <if test="null!=params.queryCondition and ''!=params.queryCondition" >
        ${params.queryCondition}
      </if>
      <if test="null!=params.locno and ''!=params.locno" >
            and LOCNO = #{params.locno,jdbcType=VARCHAR}
      </if>
      	
      <if test="null!=params.ownerNo and ''!=params.ownerNo" >
            and OWNER_NO = #{params.ownerNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.cellNo and ''!=params.cellNo" >
            and CELL_NO = #{params.cellNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.itemNo and ''!=params.itemNo" >
            and ITEM_NO = #{params.itemNo,jdbcType=VARCHAR}
      </if>
       <if test="null!=params.barcode and ''!=params.barcode" >
            and barcode = #{params.barcode,jdbcType=VARCHAR}
      </if>
      
    </if>
  </sql>
  
  <sql id="condition2" >
    <if test="null!=params" >
    
      <if test="null!=params.locno and ''!=params.locno" >
            and cc.LOCNO = #{params.locno,jdbcType=VARCHAR}
      </if>
      	
      <if test="null!=params.ownerNo and ''!=params.ownerNo" >
            and cc.OWNER_NO = #{params.ownerNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.cellNo and ''!=params.cellNo" >
            and cc.CELL_NO = #{params.cellNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.itemNo and ''!=params.itemNo" >
            <!-- and cc.ITEM_NO = #{params.itemNo,jdbcType=VARCHAR} -->
            and cc.ITEM_NO LIKE '%${params.itemNo}%'
      </if>
      
      <if test="null!=params.styleNo and ''!=params.styleNo" >
            and t.STYLE_NO = #{params.styleNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.brandNo and ''!=params.brandNo" >
			and t.BRAND_NO = #{params.brandNo,jdbcType=VARCHAR}
	  </if>
			
    </if>
  </sql>
   <sql id="selectViewCondition" >
    <if test="null!=params" >
      <if test="null!=params.queryCondition and ''!=params.queryCondition" >
        ${params.queryCondition}
      </if>
      <if test="null!=params.locno and ''!=params.locno" >
            and v.LOCNO = #{params.locno,jdbcType=VARCHAR}
      </if>
      	
      <if test="null!=params.ownerNo and ''!=params.ownerNo" >
            and v.OWNER_NO = #{params.ownerNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.cellNo and ''!=params.cellNo" >
            and v.CELL_NO = #{params.cellNo,jdbcType=VARCHAR}
      </if>
      
      <if test="null!=params.itemNo and ''!=params.itemNo" >
            and v.ITEM_NO = #{params.itemNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.quality and ''!=params.quality" >
            and v.quality = #{params.quality,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.itemType and ''!=params.itemType" >
            and v.item_type = #{params.itemType,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.sizeNo and ''!=params.sizeNo" >
            and v.SIZE_NO = #{params.sizeNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.status and ''!=params.status" >
            and v.status = #{params.status,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.hmManualFlag and ''!=params.hmManualFlag" >
            and v.hm_manual_flag = #{params.hmManualFlag,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.flag and ''!=params.flag" >
            and v.flag = #{params.flag,jdbcType=VARCHAR}
      </if>
    </if>
  </sql>
  <select id="selectViewByParams" resultMap="BaseResultMap2" parameterType="map" >
    select 
    <include refid="selectViewColumn" />
     from  <include refid="selectBulkQty" /> v left join item i on v.item_no=i.item_no where 1=1 
    <include refid="selectViewCondition" />
  </select>
  <sql id='selectBulkQty'>
  	(select   b.locno,b.owner_no,b.cell_no,b.item_no,b.item_type,
	    b.quality,(b.qty - nvl(x.cbqty,0)) qty,b.instock_qty,b.outstock_qty,b.pack_qty,
		b.status,b.flag,b.hm_manual_flag,b.size_no,b.barcode,
		b.cell_id   from v_content b left join (select locno,cell_no, supplier_no,item_type, quality, barcode, sum(cbqty) cbqty
                              from v_con_contentforsearchbox
                             group by locno,cell_no, supplier_no, item_type, quality, barcode) x
                    on x.locno = b.locno
                   and x.cell_no = b.cell_no
                   and x.supplier_no = b.supplier_no
                   and x.item_type = b.item_type
                   and x.quality = b.quality
                   and x.barcode = b.barcode where (b.qty - nvl(x.cbqty,0))>0)
  </sql>
  <select id="selectConBoxViewByParams" resultMap="BaseResultMap2" parameterType="map" >
	    select 
    	<include refid="selectViewColumn" />,LABEL_NO
     	from  <include refid="selectConBoxBulkQty" /> v left join item i on v.item_no=i.item_no where 1=1 
    	<include refid="selectViewCondition" />
  </select>
  <sql id='selectConBoxBulkQty'>
	  	(SELECT   B.LOCNO,B.OWNER_NO,B.CELL_NO,B.ITEM_NO,B.ITEM_TYPE,
	      B.QUALITY,NVL(X.CBQTY,0) QTY,B.INSTOCK_QTY,B.OUTSTOCK_QTY,B.PACK_QTY,
	    B.STATUS,B.FLAG,B.HM_MANUAL_FLAG,B.SIZE_NO,B.BARCODE,
	    B.CELL_ID,X.BOX_NO LABEL_NO   FROM V_CONTENT B INNER JOIN V_CON_CONTENTFORSEARCHBOX X
	    ON X.LOCNO = B.LOCNO
	     AND X.CELL_NO = B.CELL_NO
	     AND X.SUPPLIER_NO = B.SUPPLIER_NO
	     AND X.ITEM_TYPE = B.ITEM_TYPE
	     AND X.QUALITY = B.QUALITY
	     AND X.BARCODE = B.BARCODE)
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="com.yougou.logistics.city.common.model.ConContentKey" >
    select 
    <include refid="Base_Column_List" />
    from CON_CONTENT
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
      and CELL_ID = #{cellId,jdbcType=DECIMAL}
  </select>
  <select id="selectCount" resultType="java.lang.Integer" >
    select count(1) as s from CON_CONTENT where 1=1 
    <include refid="condition" />
  </select>
  <select id="selectByPage" resultMap="BaseResultMap" parameterType="map" >
    select B.* from (select A.*,rownum rn from( select 
    <include refid="Base_Column_List" />
     from CON_CONTENT where 1=1 
    <include refid="condition" />
    <if test="orderByField != null and ''!=orderByField" >
      order by ${orderByField}
      <if test="orderByField" >
        ${orderBy}
      </if>
    </if>
    ) A where rownum &lt; #{page.endRowNum}) B where rn &gt; #{page.startRowNum}
  </select>
  <!-- 分仓库存明细表(分页查询) S-->
  <sql id="condition4DivideLocConContent" >	
  	and nvl(v.qty, 0) != 0
    <if test="null!=params" >
      <if test="null!=params.locno and ''!=params.locno" >
            and v.LOCNO = #{params.locno,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.sysNo and ''!=params.sysNo" >
            and i.SYS_NO = #{params.sysNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.itemNo and ''!=params.itemNo" >
            and i.ITEM_NO like '%${params.itemNo}%'
      </if>
      <if test="null!=params.itemName and ''!=params.itemName" >
            and i.ITEM_NAME like '%${params.itemName}%'
      </if>
      <if test="null!=params.colorNo and ''!=params.colorNo" >
            and i.color_no = #{params.colorNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.brandNo and ''!=params.brandNo" >
            and i.brand_no = #{params.brandNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.cateNo and ''!=params.cateNo" >
            and i.cate_no = #{params.cateNo,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.cateCode and ''!=params.cateCode" >
            and i.cate_no in (select cate_no from category where cate_code like '${params.cateCode}%')
      </if>
      <if test="null!=params.quality and ''!=params.quality" >
            and v.quality = #{params.quality,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.itemType and ''!=params.itemType" >
            and v.item_type = #{params.itemType,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.barcode and ''!=params.barcode" >
            and v.barcode like '%${params.barcode}%'
      </if>
      <if test="null!=params.years and ''!=params.years" >
            and i.years = #{params.years,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.season and ''!=params.season" >
            and i.season = #{params.season,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.gender and ''!=params.gender" >
            and i.gender = #{params.gender,jdbcType=VARCHAR}
      </if>
      <if test="null!=params.yearsName and ''!=params.yearsName" >
            and i.years in (select itemval from LOOKUPDTL where lookupcode = 'YEARS' and ITEMNAME like '%${params.yearsName}%')
      </if>
     <!--  <if test="null!=params.seasonName and ''!=params.seasonName" >
            and i.season in (select itemval from LOOKUPDTL where lookupcode = 'SEASON' and ITEMNAME like '%${params.seasonName}%')
      </if>
      <if test="null!=params.genderName and ''!=params.genderName" >
            and i.gender in (select itemval from LOOKUPDTL where lookupcode = 'GENDER' and ITEMNAME like '%${params.genderName}%')
      </if> -->
      	<if test="null!=params.seasonValues and ''!=params.seasonValues" >
	    	and i.season in
	    	<foreach collection="params.seasonValues" item="seasonName" open="(" close=")" separator=",">
				#{seasonName}
			</foreach>
			
	  	</if>
	   	<if test="null!=params.genderValues and ''!=params.genderValues" >
	   		and i.gender in
	    	<foreach collection="params.genderValues" item="genderName" open="(" close=")" separator=",">
				#{genderName}
			</foreach>
			
	   	</if>
    </if>
    <if test="null!=authorityParams and null!=authorityParams.hasBrandNoList" >
    		and i.brand_no in <include refid="com.yougou.logistics.city.dal.database.AuthorityMapper.Verify_Authority_Brand_Sql" />
    </if>
  </sql>
  <sql id="ColumnList4DivideLocConContent">
		v.locno,i.sys_no,i.item_no,i.color_no,i.brand_no,i.cate_no,v.quality,i.years,i.season,i.gender,i.size_kind,
		sum(nvl(v.qty, 0)) qty,
        sum(nvl(v.instock_qty, 0)) instock_qty,
        sum(nvl(v.outstock_qty, 0)) outstock_qty,
        (sum(nvl(v.qty, 0)) + sum(nvl(v.instock_qty, 0)) - sum(nvl(v.outstock_qty, 0))) total_qty
  </sql>
  <sql id="groupby4DivideLocConContent">
  	group by v.locno,v.item_no,v.quality
  </sql>
  <sql id="base4DivideLocConContent">
  		select v.locno,
  			   v.item_no,
               v.quality
          from v_content v
         inner join item i
            on v.item_no = i.item_no
         where 1 = 1
			<include refid="condition4DivideLocConContent" />
			<include refid="groupby4DivideLocConContent" />
  </sql>
  <select id="selectCount4DivideLocConContent" resultType="java.lang.Integer" >
    select count(1) as s
	  from (<include refid="base4DivideLocConContent" />)
  </select>
  <select id="selectByPage4DivideLocConContent" resultMap="BaseResultMap2" parameterType="map" >
	  	select A3.*,
	  	it.sys_no,
        it.color_no,
        it.brand_no,
        it.cate_no,
        it.years,
        it.season,
        it.gender,
        it.size_kind,
        it.item_name,
	  	(select ITEMNAME from LOOKUPDTL where lookupcode = 'YEARS' and itemval = it.years) years_Name,
		(select ITEMNAME from LOOKUPDTL where lookupcode = 'SEASON' and itemval = it.season) season_Name,
		(select ITEMNAME from LOOKUPDTL where lookupcode = 'GENDER' and itemval = it.gender) gender_Name,
		(select ITEMNAME from LOOKUPDTL where lookupcode = 'AREA_QUALITY' and itemval = A3.quality) quality_Name,
		(select brand_name from brand where brand_no = it.brand_no) brand_name,
		(select cate_name from category where cate_no = it.cate_no) cate_name,
		(select color_name from color_info where color_no = it.color_no) color_name,
       vc.size_no,
       vc.qty,
       vc.instock_qty,
       vc.outstock_qty,
       nvl(vc.qty, 0) + nvl(vc.instock_qty, 0) - nvl(vc.outstock_qty, 0) total_qty
  from (select A2.*
          from (select rownum rn, A1.*
                  from (<include refid="base4DivideLocConContent" />) A1  where rownum &lt; #{page.endRowNum}) A2
                  where 1=1
                  and A2.rn &gt; #{page.startRowNum}) A3
                  inner join item it
                  on it.item_no = A3.item_no
           			left join (select quality,
                    item_no,
                    size_no,
                    locno,
                    sum(qty) qty,
                    sum(instock_qty) instock_qty,
                    sum(outstock_qty) outstock_qty
               from v_content
              group by quality, item_no, size_no, locno) vc
    on vc.quality = A3.quality
   and vc.item_no = A3.item_no
   and vc.locno = A3.locno
 order by vc.item_no, vc.quality,vc.size_no
  </select>
  <select id="selectSizeAndNum4DivideLocConContent" resultMap="BaseResultMap2" parameterType="map" >
    select sum(vc.qty) qty
  from (<include refid="base4DivideLocConContent" />) A3
  left join (select quality,
                    item_no,
                    size_no,
                    locno,
                    sum(qty) qty,
                    sum(instock_qty) instock_qty,
                    sum(outstock_qty) outstock_qty
               from v_content
              group by quality, item_no, size_no, locno) vc
    on vc.quality = A3.quality
   and vc.item_no = A3.item_no
   and vc.locno = A3.locno
  </select>
  <!-- 分仓库存明细表(分页查询) E-->
  <select id="selectByParams" resultMap="BaseResultMap" parameterType="map" >
    select 
    <include refid="Base_Column_List" />
     from CON_CONTENT where 1=1 
    <include refid="condition" />
  </select>
  
  <!-- 查询库存分页总数 -->
  <select id="selectCountMx" resultType="java.lang.Integer"  >
     select count(1) as s from 
     (
     	select t.item_no,
		       t.item_name,
		       t.color_no,
		       t.style_no,
		       cc.cell_no,
		       cc.pack_qty,
		       NVL(sum(cc.qty),0) as sumQty,
		       (NVL(sum(cc.qty),0)-NVL(sum(cc.outstock_qty),0)) as sumPlanQty,
		       cc.size_no,
		       max(ci.color_name) as colorName
		from v_content cc
		inner join item t  on t.item_no=cc.item_no  and t.qmin_operate_packing=cc.pack_qty
		<include refid="d_AuthorityCondition_A" />
		left  join color_info ci	on t.color_no=ci.color_no
		INNER JOIN cm_defcell cm ON cm.locno = cc.locno AND cm.cell_no = cc.cell_no
		INNER JOIN cm_defarea cmd ON cmd.locno = cc.locno AND cmd.area_no = cm.area_no AND cmd.ware_no = cm.ware_no
		where 1=1 
			and cc.flag='0' 
			and cc.status='0' 
			and (cc.qty-cc.outstock_qty)>0
			and cc.hm_manual_flag = '1'
		<include refid="condition2" />
		and (cmd.ATTRIBUTE_TYPE = '0' OR cmd.ATTRIBUTE_TYPE = '1')
		group by t.item_no, t.item_name,t.color_no,cc.barcode,t.style_no,cc.cell_no,cc.size_no,cc.pack_qty,cc.quality,cc.item_type
     )a
  </select>
  
  <!-- 查询库存数量（带分页） -->
  <select id="selectConContentByPage" resultMap="BaseResultMap2" >
		select B.* from (select A.*,rownum rn from( 
		
			select t.item_no,
		       t.item_name,
		       t.color_no,
		       t.style_no,
		       cc.cell_no,
		       cc.pack_qty,
		       NVL(sum(cc.qty),0) as sumQty,
		       (NVL(sum(cc.qty),0)-NVL(sum(cc.outstock_qty),0)) as sumPlanQty,
		       cc.size_no,
		       max(ci.color_name) as colorName,
		       cc.quality,
		       cc.item_type,
		       max(t.brand_no) as brandNo
		from v_content cc
		inner join item t  on t.item_no=cc.item_no  and t.qmin_operate_packing=cc.pack_qty
		<include refid="d_AuthorityCondition_A" />
		left  join color_info ci	on t.color_no=ci.color_no
		INNER JOIN cm_defcell cm ON cm.locno = cc.locno AND cm.cell_no = cc.cell_no
		INNER JOIN cm_defarea cmd ON cmd.locno = cc.locno AND cmd.area_no = cm.area_no AND cmd.ware_no = cm.ware_no
		where 1=1 
			and cc.flag='0' 
			and cc.status='0' 
			and (cc.qty-cc.outstock_qty)>0
			and cc.hm_manual_flag = '1'
	    <include refid="condition2" />
	    and (cmd.ATTRIBUTE_TYPE = '0' OR cmd.ATTRIBUTE_TYPE = '1')
		group by t.item_no, t.item_name,t.color_no,cc.barcode,t.style_no,cc.cell_no,cc.size_no,cc.pack_qty,cc.quality,cc.item_type
	    
	    ) A where rownum &lt; #{page.endRowNum}) B where rn &gt; #{page.startRowNum}	
  </select>
  
  
  <select id="selectConContent" resultMap="BaseResultMap2"  >
     select * from 
     (
     	select t.item_no,
		       t.item_name,
		       t.color_no,
		       t.style_no,
		       cc.cell_no,
		       cc.pack_qty,
		       NVL(sum(cc.qty),0) as sumQty,
		       (NVL(sum(cc.qty),0)-NVL(sum(cc.outstock_qty),0)) as sumPlanQty,
		       cc.size_no,
		       max(ci.color_name) as colorName
		from v_content cc
		inner join item t  on t.item_no=cc.item_no  and t.qmin_operate_packing=cc.pack_qty
		<include refid="d_AuthorityCondition_A" />
		left  join color_info ci	on t.color_no=ci.color_no
		INNER JOIN cm_defcell cm ON cm.locno = cc.locno AND cm.cell_no = cc.cell_no
		INNER JOIN cm_defarea cmd ON cmd.locno = cc.locno AND cmd.area_no = cm.area_no AND cmd.ware_no = cm.ware_no
		where 1=1 
			and cc.flag='0' 
			and cc.status='0' 
			and (cc.qty-cc.outstock_qty)>0
			and cc.hm_manual_flag = '1'
		<include refid="condition2" />
		and (cmd.ATTRIBUTE_TYPE = '0' OR cmd.ATTRIBUTE_TYPE = '1')
		group by t.item_no, t.item_name,t.color_no,cc.barcode,t.style_no,cc.cell_no,cc.size_no,cc.pack_qty,cc.quality,cc.item_type
     )a
  </select>
  
   <!-- 查询库存更新 -->
  <select id="selectConContentByItemKey" resultMap="BaseResultMap" parameterType="com.yougou.logistics.city.common.model.ConContentKey"  >
  		select 
	    <include refid="Base_Column_List" />
	    from CON_CONTENT
	    where LOCNO = #{locno,jdbcType=VARCHAR}
	      	and CELL_NO = #{cellNo,jdbcType=VARCHAR}
         	and ITEM_NO = #{itemNo,jdbcType=VARCHAR}
         	<!-- and ITEM_ID = #{itemId,jdbcType=DECIMAL} -->
         	<if test="null!=cellId and ''!=cellId" >
            	and CELL_ID = #{cellId,jdbcType=DECIMAL}
      	 	</if>
  </select>
  
  <!-- 查询仓库列表 -->
  <select id="getLocnoByContent" resultType="java.lang.String" >
  		select  distinct c.locno  from CON_CONTENT c 
  </select>
  
  <!-- 验证查询储位是否存在库存 -->
  <select id="selectCmdefCellIsHaveConContent" resultMap="BaseResultMap" >
    select CELL_NO from CON_CONTENT  where 1=1 
    <if test="null!=list and list.size > 0">
    	and CELL_NO in 
	    <foreach collection="list" item="item"  open="(" separator="," close=")">  
	        #{item.cellNo}  
	    </foreach>
    </if>
    <include refid="condition" />
    group by CELL_NO
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="com.yougou.logistics.city.common.model.ConContentKey" >
    delete from CON_CONTENT
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
      and CELL_ID = #{cellId,jdbcType=DECIMAL}
  </delete>
  <delete id="deleteByPrimarayKeyForModel" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    delete from CON_CONTENT
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
      and CELL_ID = #{cellId,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    insert into CON_CONTENT (LOCNO, CELL_NO, CELL_ID, 
      OWNER_NO, CONTAINER_NO, ITEM_NO, 
      ITEM_ID, PACK_QTY, QTY, 
      OUTSTOCK_QTY, INSTOCK_QTY, UNUSUAL_QTY, 
      STATUS, FLAG, INSTOCK_TYPE, 
      HM_MANUAL_FLAG, CREATOR, CREATETM, 
      EDITOR, EDITTM, LABEL_NO, 
      STOCK_TYPE, STOCK_VALUE, TASK_NO
      )
    values (#{locno,jdbcType=VARCHAR}, #{cellNo,jdbcType=VARCHAR}, #{cellId,jdbcType=DECIMAL}, 
      #{ownerNo,jdbcType=VARCHAR}, #{containerNo,jdbcType=VARCHAR}, #{itemNo,jdbcType=VARCHAR}, 
      #{itemId,jdbcType=DECIMAL}, #{packQty,jdbcType=DECIMAL}, #{qty,jdbcType=DECIMAL}, 
      #{outstockQty,jdbcType=DECIMAL}, #{instockQty,jdbcType=DECIMAL}, #{unusualQty,jdbcType=DECIMAL}, 
      #{status,jdbcType=VARCHAR}, #{flag,jdbcType=VARCHAR}, #{instockType,jdbcType=CHAR}, 
      #{hmManualFlag,jdbcType=VARCHAR}, #{creator,jdbcType=VARCHAR}, #{createtm,jdbcType=TIMESTAMP}, 
      #{editor,jdbcType=VARCHAR}, #{edittm,jdbcType=TIMESTAMP}, #{labelNo,jdbcType=VARCHAR}, 
      #{stockType,jdbcType=VARCHAR}, #{stockValue,jdbcType=VARCHAR}, #{taskNo,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    insert into CON_CONTENT
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="locno != null" >
        LOCNO,
      </if>
      <if test="cellNo != null" >
        CELL_NO,
      </if>
      <if test="cellId != null" >
        CELL_ID,
      </if>
      <if test="ownerNo != null" >
        OWNER_NO,
      </if>
      <if test="containerNo != null" >
        CONTAINER_NO,
      </if>
      <if test="itemNo != null" >
        ITEM_NO,
      </if>
      <if test="itemId != null" >
        ITEM_ID,
      </if>
      <if test="packQty != null" >
        PACK_QTY,
      </if>
      <if test="qty != null" >
        QTY,
      </if>
      <if test="outstockQty != null" >
        OUTSTOCK_QTY,
      </if>
      <if test="instockQty != null" >
        INSTOCK_QTY,
      </if>
      <if test="unusualQty != null" >
        UNUSUAL_QTY,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="flag != null" >
        FLAG,
      </if>
      <if test="instockType != null" >
        INSTOCK_TYPE,
      </if>
      <if test="hmManualFlag != null" >
        HM_MANUAL_FLAG,
      </if>
      <if test="creator != null" >
        CREATOR,
      </if>
      <if test="createtm != null" >
        CREATETM,
      </if>
      <if test="editor != null" >
        EDITOR,
      </if>
      <if test="edittm != null" >
        EDITTM,
      </if>
      <if test="labelNo != null" >
        LABEL_NO,
      </if>
      <if test="stockType != null" >
        STOCK_TYPE,
      </if>
      <if test="stockValue != null" >
        STOCK_VALUE,
      </if>
      <if test="taskNo != null" >
        TASK_NO,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="locno != null" >
        #{locno,jdbcType=VARCHAR},
      </if>
      <if test="cellNo != null" >
        #{cellNo,jdbcType=VARCHAR},
      </if>
      <if test="cellId != null" >
        #{cellId,jdbcType=DECIMAL},
      </if>
      <if test="ownerNo != null" >
        #{ownerNo,jdbcType=VARCHAR},
      </if>
      <if test="containerNo != null" >
        #{containerNo,jdbcType=VARCHAR},
      </if>
      <if test="itemNo != null" >
        #{itemNo,jdbcType=VARCHAR},
      </if>
      <if test="itemId != null" >
        #{itemId,jdbcType=DECIMAL},
      </if>
      <if test="packQty != null" >
        #{packQty,jdbcType=DECIMAL},
      </if>
      <if test="qty != null" >
        #{qty,jdbcType=DECIMAL},
      </if>
      <if test="outstockQty != null" >
        #{outstockQty,jdbcType=DECIMAL},
      </if>
      <if test="instockQty != null" >
        #{instockQty,jdbcType=DECIMAL},
      </if>
      <if test="unusualQty != null" >
        #{unusualQty,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="flag != null" >
        #{flag,jdbcType=VARCHAR},
      </if>
      <if test="instockType != null" >
        #{instockType,jdbcType=CHAR},
      </if>
      <if test="hmManualFlag != null" >
        #{hmManualFlag,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createtm != null" >
        #{createtm,jdbcType=TIMESTAMP},
      </if>
      <if test="editor != null" >
        #{editor,jdbcType=VARCHAR},
      </if>
      <if test="edittm != null" >
        #{edittm,jdbcType=TIMESTAMP},
      </if>
      <if test="labelNo != null" >
        #{labelNo,jdbcType=VARCHAR},
      </if>
      <if test="stockType != null" >
        #{stockType,jdbcType=VARCHAR},
      </if>
      <if test="stockValue != null" >
        #{stockValue,jdbcType=VARCHAR},
      </if>
      <if test="taskNo != null" >
        #{taskNo,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  <update id="updateConContentByItemKey" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    update CON_CONTENT
    <set >
      <if test="ownerNo != null" >
        OWNER_NO = #{ownerNo,jdbcType=VARCHAR},
      </if>
      <if test="containerNo != null" >
        CONTAINER_NO = #{containerNo,jdbcType=VARCHAR},
      </if>
      <if test="itemNo != null" >
        ITEM_NO = #{itemNo,jdbcType=VARCHAR},
      </if>
      <if test="itemId != null" >
        ITEM_ID = #{itemId,jdbcType=DECIMAL},
      </if>
      <if test="packQty != null" >
        PACK_QTY = #{packQty,jdbcType=DECIMAL},
      </if>
      <if test="qty != null" >
        QTY = #{qty,jdbcType=DECIMAL},
      </if>
      <if test="outstockQty != null" >
        OUTSTOCK_QTY = #{outstockQty,jdbcType=DECIMAL},
      </if>
      <if test="instockQty != null" >
        INSTOCK_QTY = #{instockQty,jdbcType=DECIMAL},
      </if>
      <if test="unusualQty != null" >
        UNUSUAL_QTY = #{unusualQty,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
      <if test="flag != null" >
        FLAG = #{flag,jdbcType=VARCHAR},
      </if>
      <if test="instockType != null" >
        INSTOCK_TYPE = #{instockType,jdbcType=CHAR},
      </if>
      <if test="hmManualFlag != null" >
        HM_MANUAL_FLAG = #{hmManualFlag,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        CREATOR = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createtm != null" >
        CREATETM = #{createtm,jdbcType=TIMESTAMP},
      </if>
      <if test="editor != null" >
        EDITOR = #{editor,jdbcType=VARCHAR},
      </if>
      <if test="edittm != null" >
        EDITTM = #{edittm,jdbcType=TIMESTAMP},
      </if>
      <if test="labelNo != null" >
        LABEL_NO = #{labelNo,jdbcType=VARCHAR},
      </if>
      <if test="stockType != null" >
        STOCK_TYPE = #{stockType,jdbcType=VARCHAR},
      </if>
      <if test="stockValue != null" >
        STOCK_VALUE = #{stockValue,jdbcType=VARCHAR},
      </if>
      <if test="taskNo != null" >
        TASK_NO = #{taskNo,jdbcType=VARCHAR},
      </if>
    </set>
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
            and ITEM_NO = #{itemNo,jdbcType=VARCHAR}
            <!-- and ITEM_ID = #{itemId,jdbcType=DECIMAL} -->
            <if test="null!=cellId and ''!=cellId" >
            	and CELL_ID = #{cellId,jdbcType=DECIMAL}
      	 	</if>
  </update>
  
  <update id="updateByPrimaryKeySelective" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    update CON_CONTENT
    <set >
      <if test="ownerNo != null" >
        OWNER_NO = #{ownerNo,jdbcType=VARCHAR},
      </if>
      <if test="containerNo != null" >
        CONTAINER_NO = #{containerNo,jdbcType=VARCHAR},
      </if>
      <if test="itemNo != null" >
        ITEM_NO = #{itemNo,jdbcType=VARCHAR},
      </if>
      <if test="itemId != null" >
        ITEM_ID = #{itemId,jdbcType=DECIMAL},
      </if>
      <if test="packQty != null" >
        PACK_QTY = #{packQty,jdbcType=DECIMAL},
      </if>
      <if test="qty != null" >
        QTY = #{qty,jdbcType=DECIMAL},
      </if>
      <if test="outstockQty != null" >
        OUTSTOCK_QTY = #{outstockQty,jdbcType=DECIMAL},
      </if>
      <if test="instockQty != null" >
        INSTOCK_QTY = #{instockQty,jdbcType=DECIMAL},
      </if>
      <if test="unusualQty != null" >
        UNUSUAL_QTY = #{unusualQty,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
      <if test="flag != null" >
        FLAG = #{flag,jdbcType=VARCHAR},
      </if>
      <if test="instockType != null" >
        INSTOCK_TYPE = #{instockType,jdbcType=CHAR},
      </if>
      <if test="hmManualFlag != null" >
        HM_MANUAL_FLAG = #{hmManualFlag,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        CREATOR = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createtm != null" >
        CREATETM = #{createtm,jdbcType=TIMESTAMP},
      </if>
      <if test="editor != null" >
        EDITOR = #{editor,jdbcType=VARCHAR},
      </if>
      <if test="edittm != null" >
        EDITTM = #{edittm,jdbcType=TIMESTAMP},
      </if>
      <if test="labelNo != null" >
        LABEL_NO = #{labelNo,jdbcType=VARCHAR},
      </if>
      <if test="stockType != null" >
        STOCK_TYPE = #{stockType,jdbcType=VARCHAR},
      </if>
      <if test="stockValue != null" >
        STOCK_VALUE = #{stockValue,jdbcType=VARCHAR},
      </if>
      <if test="taskNo != null" >
        TASK_NO = #{taskNo,jdbcType=VARCHAR},
      </if>
    </set>
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
      and CELL_ID = #{cellId,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    update CON_CONTENT
    set OWNER_NO = #{ownerNo,jdbcType=VARCHAR},
      CONTAINER_NO = #{containerNo,jdbcType=VARCHAR},
      ITEM_NO = #{itemNo,jdbcType=VARCHAR},
      ITEM_ID = #{itemId,jdbcType=DECIMAL},
      PACK_QTY = #{packQty,jdbcType=DECIMAL},
      QTY = #{qty,jdbcType=DECIMAL},
      OUTSTOCK_QTY = #{outstockQty,jdbcType=DECIMAL},
      INSTOCK_QTY = #{instockQty,jdbcType=DECIMAL},
      UNUSUAL_QTY = #{unusualQty,jdbcType=DECIMAL},
      STATUS = #{status,jdbcType=VARCHAR},
      FLAG = #{flag,jdbcType=VARCHAR},
      INSTOCK_TYPE = #{instockType,jdbcType=CHAR},
      HM_MANUAL_FLAG = #{hmManualFlag,jdbcType=VARCHAR},
      CREATOR = #{creator,jdbcType=VARCHAR},
      CREATETM = #{createtm,jdbcType=TIMESTAMP},
      EDITOR = #{editor,jdbcType=VARCHAR},
      EDITTM = #{edittm,jdbcType=TIMESTAMP},
      LABEL_NO = #{labelNo,jdbcType=VARCHAR},
      STOCK_TYPE = #{stockType,jdbcType=VARCHAR},
      STOCK_VALUE = #{stockValue,jdbcType=VARCHAR},
      TASK_NO = #{taskNo,jdbcType=VARCHAR}
    where LOCNO = #{locno,jdbcType=VARCHAR}
      and CELL_NO = #{cellNo,jdbcType=VARCHAR}
      and CELL_ID = #{cellId,jdbcType=DECIMAL}
  </update>
  
  
  <!-- 完结分货任务单调用存储过程 -->
  <select id="selectContentCellid" parameterType="java.util.Map"  resultType="java.util.Map" statementType="CALLABLE" >
		<![CDATA[
			{call pkg_wms_base.proc_GetContent_Cellid (
			 	#{cellId, mode=OUT, jdbcType=DECIMAL}
			 )}
		]]>
  </select>
  
  <!-- 获取库存SEQ -->
  <select id="getNextvalId" resultType="java.lang.String" >
	   select seq_con_content_move.Nextval from dual
  </select>
  
  <!-- 扣减源库存 ，带cell_ID -->
  <select id="procUpdtContentqtyByCellID" parameterType="java.util.Map"  resultType="java.util.Map" statementType="CALLABLE" >
		<![CDATA[
			{call Pkg_CONTENT.proc_UpdtContent_qtyByCellID (
			 	#{I_locno, mode=IN, jdbcType=VARCHAR},
			 	#{I_cell_id, mode=IN, jdbcType=DECIMAL},
			 	#{I_cell_no, mode=IN, jdbcType=VARCHAR},
			 	#{I_rcell_no, mode=IN, jdbcType=VARCHAR},
			 	#{I_nQty, mode=IN, jdbcType=DECIMAL},
			 	#{I_noutstock_qty, mode=IN, jdbcType=DECIMAL},
			 	#{I_User_id, mode=IN, jdbcType=VARCHAR},
			 	#{I_paper_no, mode=IN, jdbcType=VARCHAR},
			 	#{I_terminal_flag, mode=IN, jdbcType=VARCHAR},
			 	#{I_nRow_id, mode=IN, jdbcType=DECIMAL},
			 	#{I_nInsertLog_flag, mode=IN, jdbcType=DECIMAL},
			 	#{strOutMsg, mode=OUT, jdbcType=VARCHAR}
			 )}
		]]>
  </select>
    
  
  <sql id="Base_selectConContent">
  		and nvl(c.qty, 0) > 0
  		<if test="null!=dto.itemNo and ''!=dto.itemNo" >
  			and it.item_no like '%${dto.itemNo}%'
		</if>
		<if test="null!=dto.sysNo and ''!=dto.sysNo" >
			and it.sys_no = #{dto.sysNo}
		</if>
		<if test="null!=dto.locno and ''!=dto.locno" >
			and c.locno = #{dto.locno}
		</if>
		<if test="null!=dto.brandNo and ''!=dto.brandNo" >
			and it.brand_no like '%${dto.brandNo}%'
		</if>
		<if test="null!=dto.itemName and ''!=dto.itemName" >
			and it.item_name LIKE '%${dto.itemName}%'
		</if>
		<if test="null!=dto.yearsName and ''!=dto.yearsName" >
	    	and it.years in (select itemval from LOOKUPDTL where lookupcode = 'YEARS' and ITEMNAME like '%${dto.yearsName}%')
	  	</if>
	   	<if test="null!=dto.seasonValues and ''!=dto.seasonValues" >
	    	and it.season in
	    	<foreach collection="dto.seasonValues" item="seasonName" open="(" close=")" separator=",">
				#{seasonName}
			</foreach>
			
	  	</if>
	   	<if test="null!=dto.genderValues and ''!=dto.genderValues" >
	   		and it.gender in
	    	<foreach collection="dto.genderValues" item="genderName" open="(" close=")" separator=",">
				#{genderName}
			</foreach>
			
	   	</if>
		<choose>
			<when test="dto.cateThreeValues != null">
				<foreach collection="dto.cateThreeValues" item="value" open=" and (" close=")" separator="or">
					ca.search_code like '${value}%'
				</foreach>
			</when>
			<when test="dto.cateTwoValues != null">
				<foreach collection="dto.cateTwoValues" item="value" open="and (" close=")" separator="or">
					ca.search_code like '${value}%'
				</foreach>
			</when>
			<when test="dto.cateOneValues != null">
				<foreach collection="dto.cateOneValues" item="value" open="and (" close=")" separator="or">
					ca.search_code like '${value}%'
				</foreach>
			</when>
			<otherwise>
			</otherwise>
	   	</choose> 
  </sql>
  
  
  <!-- 根据商品信息查询库存商品 -->
  <select id="selectConContentGroupBy" resultMap="BaseResultMap2" parameterType="com.yougou.logistics.city.common.dto.ConContentDto" >
  		select A3.*,
		       vc.size_no,
		       vc.qty,
		       vc.instock_qty,
		       vc.outstock_qty,
		       nvl(vc.qty, 0) + nvl(vc.instock_qty, 0) - nvl(vc.outstock_qty, 0) total_qty,
		       (select ITEMNAME from LOOKUPDTL where lookupcode = 'YEARS' and itemval = A3.years) years_Name,
    		   (select ITEMNAME from LOOKUPDTL where lookupcode = 'SEASON' and itemval = A3.season) season_Name,
    		   (select ITEMNAME from LOOKUPDTL where lookupcode = 'GENDER' and itemval = A3.gender) gender_Name,
    		   (select cate_name from category where cate_no = A3.cate_no) cate_name
		  from (select A2.*
		          from (select A1.*, rownum rn
		                  from (<include refid="base4InstantConContent" />) A1
		                 where rownum &lt; #{page.endRowNum}) A2
		         where A2.rn &gt; #{page.startRowNum}) A3
		  left join (select item_no,
		                    size_no,
		                    locno,
		                    sum(qty) qty,
		                    sum(instock_qty) instock_qty,
		                    sum(outstock_qty) outstock_qty
		               from v_content
		               where nvl(qty, 0) > 0
		              group by item_no, size_no, locno) vc
		    on vc.item_no = A3.item_no
		   and vc.locno = A3.locno
		 order by vc.item_no, vc.size_no
  </select>
  <sql id="base4InstantConContent">
  		select c.locno,
			  	 	c.item_no,
			  	 	it.item_name,
		       		it.size_kind,
		       		it.sale_price,
		       		ci.color_name,
		       		it.years,
               		it.season,
               		it.gender,
               		it.cate_no
		 	 	from v_content c
		 		inner join item it on it.item_no = c.item_no
		 		<include refid="d_AuthorityCondition" />
		 		left join category ca on it.cate_no=ca.cate_no
		  		left join color_info ci on ci.color_no = it.color_no
				where 1=1
				<include refid="Base_selectConContent" />
			  	 group by 
			  	 	c.locno,
			  	 	c.item_no,
			  	 	it.item_name,
		       		it.size_kind,
		       		it.sale_price,
		       		ci.color_name,
		       		it.years,
               		it.season,
               		it.gender,
               		it.cate_no
  </sql>
  <!-- 根据商品信息查询库存商品 -->
  <select id="selectConContentCount" resultType="java.lang.Integer"  >
  		select count(1) as s
			from(<include refid="base4InstantConContent" />)
  </select>
  <!-- 根据商品信息查询库存商品总计 -->
  <select id="selectInstantConContentSum" resultMap="BaseResultMap2" parameterType="com.yougou.logistics.city.common.dto.ConContentDto" >
        
        select sum(nvl(vc.qty, 0) * nvl(A3.sale_price, 0)) totalSalePrice, sum(nvl(vc.qty, 0)) totalQty
		  from (<include refid="base4InstantConContent" />) A3
		  left join (select item_no,
		                    size_no,
		                    locno,
		                    sum(qty) qty,
		                    sum(instock_qty) instock_qty,
		                    sum(outstock_qty) outstock_qty
		               from v_content
		               where nvl(qty, 0) > 0
		              group by item_no, size_no, locno) vc
		    on vc.item_no = A3.item_no
		   and vc.locno = A3.locno
        
        <!-- select 
	       c.size_no,
	       sum(c.qty) qty,
	       sum(NVL(it.sale_price,0)*c.qty) sale_price,
	       it.size_kind
	  from v_content c
	 		inner join item it on it.item_no = c.item_no
	 		<include refid="d_AuthorityCondition" />
	  		left join category ca on it.cate_no=ca.cate_no
	  		left join color_info ci on ci.color_no = it.color_no
			where 1=1
			<include refid="Base_selectConContent" />
		  	group by c.size_no,it.size_kind
		  	 -->
  </select>
  <!-- 根据商品信息查询库存商品 -->
  <select id="selectConContentByItemNo" resultMap="BaseResultMap2" parameterType="com.yougou.logistics.city.common.dto.ConContentDto" >
        select c.locno,
	       c.item_no,
	       c.size_no,
	       c.qty,
	       c.instock_qty,
	       c.outstock_qty,
	       it.item_name,
	       it.size_kind,
	       it.sale_price,
	       ci.color_name,
	       it.years,
           it.season,
           it.gender,
          (select ITEMNAME
                  from LOOKUPDTL
                 where lookupcode = 'YEARS'
                   and itemval = it.years) years_Name,
          (select ITEMNAME
                  from LOOKUPDTL
                 where lookupcode = 'SEASON'
                   and itemval = it.season) season_Name,
          (select ITEMNAME
                  from LOOKUPDTL
                 where lookupcode = 'GENDER'
                   and itemval = it.gender) gender_Name,
               it.cate_no,
          (select cate_name from category where cate_no = it.cate_no) cate_name
	  from v_content c
	 	inner join item it on it.item_no = c.item_no
	 	<include refid="d_AuthorityCondition" />
	  	left join color_info ci on ci.color_no = it.color_no
		where 1=1
		 <if test="null!=dto.locno and ''!=dto.locno" >
		 	and c.locno = #{dto.locno,jdbcType=VARCHAR}
	  	 </if>
		 <if test="null!=dto.sysNo and ''!=dto.sysNo" >
			and it.sys_no = #{dto.sysNo,jdbcType=VARCHAR}
		 </if>
		 <if test="null!=dto.itemNo and ''!=dto.itemNo" >
		 	and it.item_no like '%${dto.itemNo}%'
	  	 </if>
	  	 <if test="null!=dto.cateNo and dto.cateNo!=''">
      		and it.cate_no = #{dto.cateNo,jdbcType=VARCHAR}
	  	</if>
	  	<if test="null!=dto.years and dto.years!=''">
			and it.years = #{dto.years,jdbcType=VARCHAR}
	  	</if>
	  	<if test="null!=dto.season and dto.season!=''">
			and it.season = #{dto.season,jdbcType=VARCHAR}
	  	</if>
	  	<if test="null!=dto.gender and dto.gender!=''">
			and it.gender = #{dto.gender,jdbcType=VARCHAR}
	  	</if>
  </select>
  <!--权限过滤查询条件-->
  <sql id="d_AuthorityCondition" >
     <if test="null!=authorityParams and null!=authorityParams.hasBrandNoList" >
       and it.brand_no in <include refid="com.yougou.logistics.city.dal.database.AuthorityMapper.Verify_Authority_Brand_Sql" />
    </if>
  </sql>
  <!--权限过滤查询条件-->
  <sql id="d_AuthorityCondition_A" >
     <if test="null!=authorityParams and null!=authorityParams.hasBrandNoList" >
       and t.brand_no in <include refid="com.yougou.logistics.city.dal.database.AuthorityMapper.Verify_Authority_Brand_Sql" />
    </if>
  </sql>
  <!-- 更新库存状态 -->
  <update id="updateStatus" parameterType="com.yougou.logistics.city.common.model.ConContent" >
    update CON_CONTENT
    set 
      STATUS = #{params.status,jdbcType=VARCHAR},
      EDITOR = #{params.editor,jdbcType=VARCHAR},
      EDITTM = #{params.edittm,jdbcType=TIMESTAMP}
    where LOCNO = #{params.locno,jdbcType=VARCHAR}
      and CELL_NO = #{params.cellNo,jdbcType=VARCHAR}
      and ITEM_NO = #{params.itemNo,jdbcType=VARCHAR}
      and BARCODE = #{params.barcode,jdbcType=VARCHAR}
      and ITEM_TYPE = #{params.itemType,jdbcType=VARCHAR}
      and QUALITY = #{params.quality,jdbcType=VARCHAR}
      <if test="params.cellId != null">
      	and CELL_ID = #{params.cellId,jdbcType=DECIMAL}
      </if>
      <if test="params.sourceStatus != null and params.sourceStatus != ''">
      	and status = #{params.sourceStatus,jdbcType=VARCHAR}
      </if>
  </update>
</mapper>