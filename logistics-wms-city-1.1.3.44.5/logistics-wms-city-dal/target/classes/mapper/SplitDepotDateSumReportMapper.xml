<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yougou.logistics.city.dal.mapper.SplitDepotDateSumReportMapper" >
  <resultMap id="BaseResultMap" type="com.yougou.logistics.city.common.model.SplitDepotDateSumReport" >
   	<result property="qty" column="qty" jdbcType="DECIMAL" />
    <result property="rkCrkQty" column="rk_crk_qty" jdbcType="DECIMAL" />
    <result property="rkCyrQty" column="rk_cyr_qty" jdbcType="DECIMAL" />
    <result property="rkDthQty" column="rk_dth_qty" jdbcType="DECIMAL" />
    <result property="rkQtrkQty" column="rk_qtrk_qty" jdbcType="DECIMAL" />
    <result property="rkCytzQty" column="rk_cytz_qty" jdbcType="DECIMAL" />
    <result property="ckCcdQty" column="ck_ccd_qty" jdbcType="DECIMAL" />
    <result property="ckCycQty" column="ck_cyc_qty" jdbcType="DECIMAL" />
    <result property="ckQtckQty" column="ck_qtck_qty" jdbcType="DECIMAL" />
    <result property="ckZjckQty" column="ck_zjck_qty" jdbcType="DECIMAL" />
    <result property="ckKbmzhQty" column="ck_kbmzh_qty" jdbcType="DECIMAL" />
    <result property="ckCytzQty" column="ck_cytz_qty" jdbcType="DECIMAL" />
    <result property="pdPyQty" column="pd_py_qty" jdbcType="DECIMAL" />
    <result property="pdPkQty" column="pd_pk_qty" jdbcType="DECIMAL" />
    <result property="tzKctzQty" column="tz_kctz_qty" jdbcType="DECIMAL" />
    <result property="tzKctzCalcQty" column="tz_kctz_calc_qty" jdbcType="DECIMAL" />
    <result property="tzKctzTypeQty" column="tz_kctz_type_qty" jdbcType="DECIMAL" />
    <result property="ydhCrQty" column="ydh_cr_qty" jdbcType="DECIMAL" />
    <result property="ydhCyrQty" column="ydh_cyr_qty" jdbcType="DECIMAL" />
    <result property="ydhDtcQty" column="ydh_dtc_qty" jdbcType="DECIMAL" />
    <result property="yswyCrQty" column="yswy_cr_qty" jdbcType="DECIMAL" />
    <result property="yswyCyrQty" column="yswy_cyr_qty" jdbcType="DECIMAL" />
    <result property="yswyDtcQty" column="yswy_dtc_qty" jdbcType="DECIMAL" />
    
    <result property="ydhCrBoxQty" column="ydh_cr_box_qty" jdbcType="DECIMAL" />
    <result property="ydhCyrBoxQty" column="ydh_cyr_box_qty" jdbcType="DECIMAL" />
    <result property="ydhDtcBoxQty" column="ydh_dtc_box_qty" jdbcType="DECIMAL" />
    <result property="yswyCrBoxQty" column="yswy_cr_box_qty" jdbcType="DECIMAL" />
    <result property="yswyCyrBoxQty" column="yswy_cyr_box_qty" jdbcType="DECIMAL" />
    <result property="yswyDtcBoxQty" column="yswy_dtc_box_qty" jdbcType="DECIMAL" />
    
    <result property="yshCrBoxQty" column="ysh_cr_box_qty" jdbcType="DECIMAL" />
    <result property="yshCyrBoxQty" column="ysh_cyr_box_qty" jdbcType="DECIMAL" />
    <result property="yshDtcBoxQty" column="ysh_dtc_box_qty" jdbcType="DECIMAL" />
    
    <result property="yshCrQty" column="ysh_cr_qty" jdbcType="DECIMAL" />
    <result property="yshCyrQty" column="ysh_cyr_qty" jdbcType="DECIMAL" />
    <result property="yshDtcQty" column="ysh_dtc_qty" jdbcType="DECIMAL" />
    <result property="thisIssueQty" column="this_issue_qty" jdbcType="DECIMAL" />
    <result property="selectDate" column="select_date" jdbcType="TIMESTAMP" />
    <result property="startDate" column="startDate" jdbcType="TIMESTAMP" />
    <result property="endDate" column="endDate" jdbcType="TIMESTAMP" />
  </resultMap>
  
   
  <!--权限过滤查询条件-->
  <sql id="AuthorityCondition" >
     <if test="null!=authorityParams and null!=authorityParams.hasBrandNoList" >
       and it.brand_no in <include refid="com.yougou.logistics.city.dal.database.AuthorityMapper.Verify_Authority_Brand_Sql" />
    </if>
  </sql>
  
  <sql id="condition">
		<if test="null!=params.brandNoValues and ''!=params.brandNoValues">
			<!-- and it.brand_no = #{params.brandNo,jdbcType=VARCHAR} -->
			and it.brand_no in (${params.brandNoValues})
		</if>
		<if test="null!=params.cateCode and ''!=params.cateCode">
			and it.cate_no in (select cate_no from category where cate_code like '${params.cateCode}%')
		</if>
		<choose>
			<when test="params.cateThreeValues != null">
				<foreach collection="params.cateThreeValues" item="value" open=" and (" close=")" separator="or">
					c.search_code like '${value}%'
				</foreach>
			</when>
			<when test="params.cateTwoValues != null">
				<foreach collection="params.cateTwoValues" item="value" open="and (" close=")" separator="or">
					c.search_code like '${value}%'
				</foreach>
			</when>
			<when test="params.cateOneValues != null">
				<foreach collection="params.cateOneValues" item="value" open="and (" close=")" separator="or">
					c.search_code like '${value}%'
				</foreach>
			 </when>
			 <otherwise>
			 </otherwise>
	 	</choose> 
		<if test="null!=params.sysNo and ''!=params.sysNo">
			and it.sys_no = #{params.sysNo,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.years and ''!=params.years">
			and s3.itemname LIKE '%${params.years}%'
		</if>
		<!-- <if test="null!=params.season and ''!=params.season">
			and s1.itemname LIKE '%${params.season}%'
		</if>
		<if test="null!=params.gender and ''!=params.gender">
			and s2.itemname LIKE '%${params.gender}%'
		</if> -->
		<if test="null != params.seasonValues">
		    and it.season in
		   <foreach collection="params.seasonValues" item="season" open="(" close=")" separator=",">
				#{season}
			</foreach>
		</if>
		<if test="null != params.genderValues">
		    and it.gender in
		   <foreach collection="params.genderValues" item="gender" open="(" close=")" separator=",">
				#{gender}
			</foreach>
		</if>
		<if test="null!=params.itemNo and ''!=params.itemNo">
			and it.ITEM_NO LIKE '%${params.itemNo}%'
		</if>
		<include refid="AuthorityCondition" />
   </sql>
   
   <!-- 预到货通知单条件 -->
   <sql id="condition_view">
   		and v.locno = #{params.locno,jdbcType=VARCHAR}
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and v.select_date >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and v.select_date <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and v.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.itemType and ''!=params.itemType">
			and v.item_type = #{params.itemType,jdbcType=VARCHAR}
		</if>
	</sql>
   
   
   <!-- 查询往前推一天的库存条件 -->
   <sql id="condition_kc_qty">
		<if test="null!=params.quality and ''!=params.quality">
			and v.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.itemType and ''!=params.itemType">
			and v.item_type = #{params.itemType,jdbcType=VARCHAR}
		</if>
	</sql>
   
   <!-- 库存条件 -->
   <sql id="condition_kc">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and v.content_date >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and v.content_date <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and v.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.itemType and ''!=params.itemType">
			and v.item_type = #{params.itemType,jdbcType=VARCHAR}
		</if>
	</sql>
   
   <!-- 预到货通知单条件 -->
   <sql id="condition_im_import">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and ii.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and ii.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and ii.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>
	
   <!-- 店退仓通知单未收条件 -->
   <sql id="condition_uu_untread">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and uu.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and uu.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and uu.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 店退仓通知单已收未验条件 -->
   <sql id="condition_uu_receipt">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and ur.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and ur.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and ur.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.itemType and ''!=params.itemType">
			and ur.item_type = #{params.itemType,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 收货单条件 -->
   <sql id="condition_im_receipt">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and ir.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and ir.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and ird.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
		<if test="null!=params.itemType and ''!=params.itemType">
			and ird.item_type = #{params.itemType,jdbcType=VARCHAR}
		</if>
	</sql>
   
   <!-- 记账条件 -->
   <sql id="condition_ccm">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and ccm.createtm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and ccm.createtm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and ccm.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 验收单条件 -->
	<sql id="condition_icd">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and ic.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and ic.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and icd.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 装车单条件 -->
	<sql id="condition_odd">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and od.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and od.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and odd.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>
	
	<!-- 跨部门转货 -->
	<sql id="condition_kbmzh">
		<if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					and c.audittm >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					and c.audittm <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
				]]>
		</if>
		<if test="null!=params.quality and ''!=params.quality">
			and cd.quality = #{params.quality,jdbcType=VARCHAR}
		</if>
	</sql>

  <select id="selectCount" resultType="java.lang.Integer" >
    select count(1) as s from (
	  	<!--select 
  			to_char(cch.content_date, 'yyyy-mm-dd') select_date
	  	from (
	  			select (v.content_date) as content_date
	          			from con_content_history v
	          			<include refid="item_history_condition"/>
	         			where v.locno = #{params.locno,jdbcType=VARCHAR}
	         			<include refid="condition_kc"/>
	         			<include refid="condition"/>
	         	group by v.content_date
	    ) cch-->
	  <include refid="Base_Sql" />
	  )
  </select>
  
  <select id="selectByPage" resultMap="BaseResultMap" parameterType="map" >
    <!--  select B.* from (select A.*,rownum rn from(  -->
    	<include refid="Base_Sql" />
   <!-- ) A where rownum &lt; #{page.endRowNum}) B where rn &gt; #{page.startRowNum}-->
  </select>
  
  <!-- 其他通用条件 -->
  <sql id="item_other_condition">
  		inner join item it on it.item_no = rep.item_no
	  	left join category c 
         	on it.cate_no=c.cate_no
	  	left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'SEASON') s1
			on it.season = s1.itemval
	    left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'GENDER') s2
			on it.gender = s2.itemval
		left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'YEARS') s3
		on it.years = s3.itemval
  </sql>
  
  <sql id="item_history_condition">
  		inner join item it on it.item_no = v.item_no
  		left join category c 
         	on it.cate_no=c.cate_no
	  	left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'SEASON') s1
			on it.season = s1.itemval
	    left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'GENDER') s2
			on it.gender = s2.itemval
		left join (select ld.lookupcode, ld.itemval, ld.ITEMNAME
			from LOOKUPDTL ld
			where ld.lookupcode = 'YEARS') s3
		on it.years = s3.itemval
  </sql>
  
  <!-- 库存查询sql -->
  <sql id="KC_Base_Sql" >
  		select
			v.content_date as select_date, 
			v.item_no,
			sum(v.qty) qty,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
		from con_content_history v
			where v.locno = #{params.locno,jdbcType=VARCHAR}
			<include refid="condition_kc" />
		group by v.content_date,v.item_no
  </sql>
  
  <!-- 入库  厂入库sql -->
  <sql id="Rk_Crk_Base_Sql" >
  		select 
			ic.audittm as select_date,
			icd.item_no,
			sum(icd.check_qty) as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
	      	0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_check ic
			 inner join bill_im_check_dtl icd
			    on icd.locno = ic.locno
			   and icd.owner_no = ic.owner_no
			   and icd.check_no = ic.check_no
			 where ic.locno = #{params.locno,jdbcType=VARCHAR}
			   and ic.status != '10'
			   <include refid="condition_icd" />
			   and exists (select 'X'
			          from bill_im_receipt_dtl ird
			         inner join bill_im_import ii
			            on ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			         where ii.business_type = '0'
			           and ird.locno = ic.locno
			           and ird.owner_no = ic.owner_no
			           and ird.receipt_no = ic.s_import_no)
			 group by ic.audittm,icd.item_no
  </sql>
  
  <!-- 入库  仓移入sql -->
  <sql id="Rk_Cyr_Base_Sql" >
  		select 
			ic.audittm as select_date,
			icd.item_no,
			0 as rk_crk_qty,
			sum(icd.check_qty) as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_check ic
			 inner join bill_im_check_dtl icd
			    on icd.locno = ic.locno
			   and icd.owner_no = ic.owner_no
			   and icd.check_no = ic.check_no
			 where ic.locno = #{params.locno,jdbcType=VARCHAR}
			   and ic.status != '10'
			   <include refid="condition_icd" />
			   and exists (select 'X'
			          from bill_im_receipt_dtl ird
			         inner join bill_im_import ii
			            on ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			         where ii.business_type = '4'
			           and ird.locno = ic.locno
			           and ird.owner_no = ic.owner_no
			           and ird.receipt_no = ic.s_import_no)
			 group by ic.audittm,icd.item_no
  </sql>
  
  <!-- 入库  店退货sql -->
  <sql id="Rk_Dth_Base_Sql" >
  		select 
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			sum(ccm.move_qty) as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'UC'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'I'
			   <include refid="condition_ccm" />
			group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 入库  其他入库sql -->
  <sql id="Rk_Qtrk_Base_Sql" >
  		select 
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			sum(ccm.move_qty) as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			 from con_content_move ccm
			 where ccm.paper_type = 'OI'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'I'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 出库  仓出店sql -->
  <sql id="Ck_Ccd_Base_Sql" >
  		select 
			od.audittm as select_date,
			odd.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			sum(odd.qty) as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
	      	0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_om_deliver od
			 inner join bill_om_deliver_dtl odd
			    on od.locno = odd.locno
			   and od.owner_no = odd.owner_no
			   and od.deliver_no = odd.deliver_no
			 where od.locno = #{params.locno,jdbcType=VARCHAR}
			   and od.status != '10' 
			   <include refid="condition_odd" />
			   and exists (select 'X'
			          from bill_om_exp oe
			         where oe.business_type = '1'
			           and oe.exp_no = odd.exp_no)
		group by od.audittm,odd.item_no
  </sql>
  
  
  <!-- 出库  仓移出sql -->
  <sql id="Ck_Cyc_Base_Sql" >
  		select 
			od.audittm as select_date,
			odd.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			sum(odd.qty) as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_om_deliver od
			 inner join bill_om_deliver_dtl odd
			    on od.locno = odd.locno
			   and od.owner_no = odd.owner_no
			   and od.deliver_no = odd.deliver_no
			 where od.locno = #{params.locno,jdbcType=VARCHAR}
			   and od.status != '10' 
			   <include refid="condition_odd" />
			   and exists (select 'X'
			          from bill_om_exp oe
			         where oe.business_type = '4'
			           and oe.exp_no = odd.exp_no)
			 group by od.audittm,odd.item_no
  </sql>
  
  <!-- 出库 其他出库sql -->
  <sql id="Ck_Qtck_Base_Sql" >
  		select
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			sum(ccm.move_qty) as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
		    0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'SW'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'O'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 出库 其他出库sql -->
  <sql id="Ck_Kbmzh_Base_Sql" >
  		select
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			sum(ccm.move_qty) as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			from con_content_move ccm
			 where ccm.paper_type = 'CV'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'O'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  
  <!-- 出库 直接出库sql -->
  <sql id="Ck_Zjck_Base_Sql" >
  		select
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			sum(ccm.move_qty) as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
		    0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'DS'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'O'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 盘点 盘赢sql -->
  <sql id="Pd_Py_Base_Sql" >
  		select 
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			sum(ccm.move_qty) as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
      		0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'CP'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'I'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 盘点 盘赢sql -->
  <sql id="Pd_Pk_Base_Sql" >
  		select 
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			-sum(ccm.move_qty) as pd_pk_qty,
			0 as tz_kctz_qty,
	      	0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'CP'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'O'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 调整 库存调整sql -->
  <sql id="Tz_Kctz_Base_Sql" >
  		select 
			ccm.createtm as select_date,
			ccm.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			sum(ccm.move_qty) as tz_kctz_qty,
	      	0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from con_content_move ccm
			 where ccm.paper_type = 'CA'
			   and ccm.locno = #{params.locno,jdbcType=VARCHAR}
			   and ccm.io_flag = 'I'
			   <include refid="condition_ccm" />
		group by ccm.createtm,ccm.item_no
  </sql>
  
  <!-- 预计到货未收  厂入sql -->
  <sql id="Ydh_Cr_Base_Sql" >
  		select 
			ii.audittm as select_date,
			iid.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			sum(nvl(iid.po_qty,0)-nvl(iid.receipt_qty,0)) as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_import ii
			 inner join bill_im_import_dtl iid
			    on ii.locno = iid.locno
			   and ii.owner_no = iid.owner_no
			   and ii.import_no = iid.import_no
			 where ii.business_type = '0'
			    and ii.locno = #{params.locno,jdbcType=VARCHAR}
			    and ii.status not in ('10','90','91')
			    and nvl(iid.po_qty,0) > nvl(iid.receipt_qty,0)
			    <include refid="condition_im_import" />
		group by ii.audittm,iid.item_no
  </sql>
  
  <!-- 预计到货未收  厂入箱数sql -->
  <sql id="Ydh_Cr_Box_Base_Sql" >
  		select 
			ii.audittm as select_date,
			max(iid.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		count(distinct iid.box_no) as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_import ii
			 inner join bill_im_import_dtl iid
			    on ii.locno = iid.locno
			   and ii.owner_no = iid.owner_no
			   and ii.import_no = iid.import_no
			 where ii.business_type = '0'
			    and ii.locno = #{params.locno,jdbcType=VARCHAR}
			    and ii.status not in ('10','90','91')
			    and nvl(iid.po_qty,0) > nvl(iid.receipt_qty,0)
			    and iid.box_no !='N'
			    <include refid="condition_im_import" />
		group by ii.audittm,iid.box_no
  </sql>
  
  <!-- 预计到货未收  仓移入sql -->
  <sql id="Ydh_Cyr_Base_Sql" >
  		select 
			ii.audittm as select_date,
			iid.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			sum(nvl(iid.po_qty,0)-nvl(iid.receipt_qty,0)) as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_import ii
			 inner join bill_im_import_dtl iid
			    on ii.locno = iid.locno
			   and ii.owner_no = iid.owner_no
			   and ii.import_no = iid.import_no
			 where ii.business_type = '4'
			    and ii.locno = #{params.locno,jdbcType=VARCHAR}
			    and ii.status != '10'
			    and nvl(iid.po_qty,0) > nvl(iid.receipt_qty,0)
			    <include refid="condition_im_import" />
		group by ii.audittm,iid.item_no
  </sql>
  
  <!-- 预计到货未收  仓移入箱数sql -->
  <sql id="Ydh_Cyr_Box_Base_Sql" >
  		select 
			ii.audittm as select_date,
			max(iid.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			count(distinct iid.box_no) as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_import ii
			 inner join bill_im_import_dtl iid
			    on ii.locno = iid.locno
			   and ii.owner_no = iid.owner_no
			   and ii.import_no = iid.import_no
			 where ii.business_type = '4'
			    and ii.locno = #{params.locno,jdbcType=VARCHAR}
			    and ii.status != '10'
			    and iid.box_no !='N'
			    and nvl(iid.po_qty,0) > nvl(iid.receipt_qty,0)
			    <include refid="condition_im_import" />
		group by ii.audittm,iid.box_no
  </sql>
  
  <!-- 预计到货未收  店退仓sql -->
  <sql id="Ydh_Dtc_Base_Sql" >
  		select 
			uu.audittm as select_date,
			uud.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			sum(nvl(uud.item_qty, 0) - nvl(uud.receipt_qty, 0)) as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 where uu.status in ('11','20')
			   and nvl(uud.item_qty, 0) > nvl(uud.receipt_qty, 0)
			   and uu.locno = #{params.locno,jdbcType=VARCHAR}
			   <include refid="condition_uu_untread" />
		group by uu.audittm,uud.item_no
  </sql>
  
  <!-- 预计到货未收  店退仓箱数sql -->
  <sql id="Ydh_Dtc_Box_Base_Sql" >
  		select 
			uu.audittm as select_date,
			max(uud.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			count(distinct uud.box_no) as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 where uu.status in ('11','20')
			   and nvl(uud.item_qty, 0) > nvl(uud.receipt_qty, 0)
			   and uu.locno = #{params.locno,jdbcType=VARCHAR}
			   and uud.box_no !='N'
			   <include refid="condition_uu_untread" />
		group by uu.audittm,uud.box_no
  </sql>
  
  <!-- 已收未验  厂入sql -->
  <sql id="Yswy_Cr_Base_Sql" >
  		select 
			ir.audittm as select_date,
			ird.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			sum(nvl(ird.receipt_qty,0)-nvl(ird.check_qty,0)) as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and nvl(ird.receipt_qty,0) > nvl(ird.check_qty,0)
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '0')
		group by ir.audittm,ird.item_no
  </sql>
  
  
 <!-- 已收未验  厂入箱数sql -->
  <sql id="Yswy_Cr_Box_Base_Sql" >
  		select 
			ir.audittm as select_date,
			max(ird.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			count(distinct ird.box_no) as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and nvl(ird.receipt_qty,0) > nvl(ird.check_qty,0)
			   and ir.business_type = '0'
			   and ird.box_no != 'N'
			   and not exists(select 'X' from  bill_im_receipt_dtl iid where iid.locno = ird.locno
			           and iid.owner_no = ird.owner_no
			           and iid.receipt_no = ird.receipt_no
			           and iid.box_no  = ird.box_no
			           and iid.check_qty > 0)
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '0')
		group by ir.audittm,ird.box_no
  </sql>
  
  <!-- 已收未验  仓移入sql -->
  <sql id="Yswy_Cyr_Base_Sql" >
  		select 
			ir.audittm as select_date,
			ird.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			sum(nvl(ird.receipt_qty,0)-nvl(ird.check_qty,0)) as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and nvl(ird.receipt_qty,0) > nvl(ird.check_qty,0)
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '4')
		group by ir.audittm,ird.item_no
  </sql>
  
  <!-- 已收未验  仓移入箱数sql -->
  <sql id="Yswy_Cyr_Box_Base_Sql" >
  		select 
			ir.audittm as select_date,
			max(ird.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			count(distinct ird.box_no) as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and nvl(ird.receipt_qty,0) > nvl(ird.check_qty,0)
			   and ir.business_type = '0'
			   and ird.box_no !='N'
			   and not exists(select 'X' from  bill_im_receipt_dtl iid where iid.locno = ird.locno
			           and iid.owner_no = ird.owner_no
			           and iid.receipt_no = ird.receipt_no
			           and iid.box_no  = ird.box_no
			           and iid.check_qty > 0)
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '4')
		group by ir.audittm,ird.box_no
  </sql>
  
  <!-- 已收未验  店退仓sql -->
  <sql id="Yswy_Dtc_Base_Sql" >
  		select 
			ur.audittm as select_date,
			uud.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			sum(nvl(uud.receipt_qty,0)-nvl(uud.check_qty,0)) as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 inner join bill_um_receipt ur
			    on ur.locno = uu.locno
			    and ur.owner_no = uu.owner_no
			    and ur.untread_no = uu.untread_no
			 where ur.status != '10'
			   and nvl(uud.receipt_qty,0) > 0
			   and nvl(uud.receipt_qty,0) > nvl(uud.check_qty,0)
			   and uu.locno = #{params.locno,jdbcType=VARCHAR}
			   <include refid="condition_uu_receipt" />
		group by ur.audittm,uud.item_no
  </sql>
  
  
  <!-- 已收未验  店退仓箱数sql -->
  <sql id="Yswy_Dtc_Box_Base_Sql" >
  		select 
			ur.audittm as select_date,
			max(uud.item_no) as item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
			0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			count(distinct uud.box_no) as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 inner join bill_um_receipt ur
			    on ur.locno = uu.locno
			    and ur.owner_no = uu.owner_no
			    and ur.untread_no = uu.untread_no
			 where ur.status != '10'
			   and nvl(uud.receipt_qty,0) > 0
			   and nvl(uud.receipt_qty,0) > nvl(uud.check_qty,0)
			   and uud.box_no !='N'
			   and not exists(select 'X' from  bill_um_untread_dtl iid where iid.locno = uud.locno
			           and iid.owner_no = uud.owner_no
			           and iid.untread_no = uud.untread_no
			           and iid.box_no  = uud.box_no
			           and iid.check_qty > 0)
			   and uu.locno = #{params.locno,jdbcType=VARCHAR}
			   <include refid="condition_uu_receipt" />
		group by ur.audittm,uud.box_no
  </sql>
  
  <!-- 已收货数  厂入sql -->
  <sql id="Ysh_Cr_Base_Sql" >
  		select 
			ir.audittm as select_date,
			ird.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
		    0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			sum(ird.receipt_qty) as ysh_cr_qty,
			0 as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '0')
		group by ir.audittm,ird.item_no
  </sql>
  
  <!-- 已收货数 仓移入sql -->
  <sql id="Ysh_Cyr_Base_Sql" >
  		select 
			ir.audittm as select_date,
			ird.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
		    0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			sum(ird.receipt_qty) as ysh_cyr_qty,
			0 as ysh_dtc_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '4')
			 group by ir.audittm,ird.item_no
  </sql>
  
  <!-- 已收货数 店退仓sql -->
  <sql id="Ysh_Dtc_Base_Sql" >
  		select 
			ur.audittm as select_date,
			uud.item_no,
			0 as rk_crk_qty,
			0 as rk_cyr_qty,
			0 as rk_dth_qty,
			0 as rk_qtrk_qty,
			0 as ck_ccd_qty,
			0 as ck_cyc_qty,
			0 as ck_qtck_qty,
			0 as ck_kbmzh_qty,
			0 as pd_py_qty,
			0 as pd_pk_qty,
			0 as tz_kctz_qty,
		    0 as ydh_cr_qty,
      		0 as ydh_cr_box_qty,
			0 as ydh_cyr_qty,
			0 as ydh_cyr_box_qty,
			0 as ydh_dtc_qty,
			0 as ydh_dtc_box_qty,
			0 as yswy_cr_qty,
			0 as yswy_cr_box_qty,
			0 as yswy_cyr_qty,
			0 as yswy_cyr_box_qty,
			0 as yswy_dtc_qty,
			0 as yswy_dtc_box_qty,
			0 as ysh_cr_qty,
			0 as ysh_cyr_qty,
			sum(uud.receipt_qty) as ysh_dtc_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 inner join bill_um_receipt ur
			    on ur.locno = uu.locno
			    and ur.owner_no = uu.owner_no
			    and ur.untread_no = uu.untread_no
			 where ur.status != '10'
			 and nvl(uud.receipt_qty,0) > 0
			 and uu.locno = #{params.locno,jdbcType=VARCHAR}
			 <include refid="condition_uu_receipt" />
		group by ur.audittm,uud.item_no
  </sql>
  
  
  <sql id="Base_Sql" >
  		select x.select_date,
		       nvl(x.qty, 0) AS qty,
		       nvl(x.rk_crk_qty, 0) AS rk_crk_qty,
		       nvl(x.rk_cyr_qty, 0) AS rk_cyr_qty,
		       nvl(x.rk_dth_qty, 0) AS rk_dth_qty,
		       nvl(x.rk_qtrk_qty, 0) AS rk_qtrk_qty,
		       nvl(x.ck_ccd_qty, 0) AS ck_ccd_qty,
		       nvl(x.ck_cyc_qty, 0) AS ck_cyc_qty,
		       nvl(x.ck_qtck_qty, 0) AS ck_qtck_qty,
		       nvl(x.ck_kbmzh_qty, 0) AS ck_kbmzh_qty,
		       nvl(x.pd_py_qty, 0) AS pd_py_qty,
		       nvl(x.pd_pk_qty, 0) AS pd_pk_qty,
		       nvl(x.tz_kctz_qty, 0) AS tz_kctz_qty,
 			   nvl(x.ydh_cr_qty, 0) AS ydh_cr_qty,
 			   nvl(x.ydh_cr_box_qty, 0) AS ydh_cr_box_qty,
		       nvl(x.ydh_cyr_qty, 0) AS ydh_cyr_qty,
		       nvl(x.ydh_cyr_box_qty, 0) AS ydh_cyr_box_qty,
		       nvl(x.ydh_dtc_qty, 0) AS ydh_dtc_qty,
		       nvl(x.ydh_dtc_box_qty, 0) AS ydh_dtc_box_qty,
		       nvl(x.yswy_cr_qty, 0) AS yswy_cr_qty,
		       nvl(x.yswy_cr_box_qty, 0) AS yswy_cr_box_qty,
		       nvl(x.yswy_cyr_qty, 0) AS yswy_cyr_qty,
		       nvl(x.yswy_cyr_box_qty, 0) AS yswy_cyr_box_qty,
		       nvl(x.yswy_dtc_qty, 0) AS yswy_dtc_qty,
		       nvl(x.yswy_dtc_box_qty, 0) AS yswy_dtc_box_qty,
		       nvl(x.ysh_cr_qty, 0) AS ysh_cr_qty,
		       nvl(x.ysh_cyr_qty, 0) AS ysh_cyr_qty,
		       nvl(x.ysh_dtc_qty, 0) AS ysh_dtc_qty,
		       nvl(x.qty, 0)+nvl(x.rk_crk_qty, 0)+nvl(x.rk_cyr_qty, 0)+nvl(x.rk_dth_qty, 0)+nvl(x.rk_qtrk_qty, 0)
		       -nvl(x.ck_ccd_qty, 0)-nvl(x.ck_cyc_qty, 0)-nvl(x.ck_qtck_qty, 0)-nvl(x.ck_kbmzh_qty, 0)+ nvl(x.pd_py_qty, 0)-(-nvl(x.pd_pk_qty, 0)) AS this_issue_qty
		from(
		
			
			
			   select  cch.select_date,
			           cch.qty,
			           nvl(bd.rk_crk_qty, 0) rk_crk_qty,
			           nvl(bd.rk_cyr_qty, 0) rk_cyr_qty,
			           nvl(bd.rk_dth_qty, 0) rk_dth_qty,
			           nvl(bd.rk_qtrk_qty, 0) rk_qtrk_qty,
			           nvl(bd.ck_ccd_qty, 0) ck_ccd_qty,
			           nvl(bd.ck_cyc_qty, 0) ck_cyc_qty,
			           nvl(bd.ck_qtck_qty, 0) ck_qtck_qty,
			           nvl(bd.ck_kbmzh_qty, 0) ck_kbmzh_qty,
			           nvl(bd.pd_py_qty, 0) pd_py_qty,
			           nvl(bd.pd_pk_qty, 0) pd_pk_qty,
			           nvl(bd.tz_kctz_qty, 0) tz_kctz_qty,
			           nvl(bd.ydh_cr_qty, 0)  ydh_cr_qty,
 					   nvl(bd.ydh_cr_box_qty, 0)  ydh_cr_box_qty,
				       nvl(bd.ydh_cyr_qty, 0)  ydh_cyr_qty,
				       nvl(bd.ydh_cyr_box_qty, 0)  ydh_cyr_box_qty,
				       nvl(bd.ydh_dtc_qty, 0)  ydh_dtc_qty,
				       nvl(bd.ydh_dtc_box_qty, 0)  ydh_dtc_box_qty,
				       nvl(bd.yswy_cr_qty, 0)  yswy_cr_qty,
				       nvl(bd.yswy_cr_box_qty, 0)  yswy_cr_box_qty,
				       nvl(bd.yswy_cyr_qty, 0)  yswy_cyr_qty,
				       nvl(bd.yswy_cyr_box_qty, 0)  yswy_cyr_box_qty,
				       nvl(bd.yswy_dtc_qty, 0)  yswy_dtc_qty,
				       nvl(bd.yswy_dtc_box_qty, 0)  yswy_dtc_box_qty,
			           nvl(bd.ysh_cr_qty, 0) ysh_cr_qty,
			           nvl(bd.ysh_cyr_qty, 0) ysh_cyr_qty,
			           nvl(bd.ysh_dtc_qty, 0) ysh_dtc_qty from (
			    
			     <!-- 更改查询前一天的库存数量方式 -->
			     <!--  
			     select to_char(v1.content_date, 'yyyy-mm-dd') as select_date,
			     	nvl(v2.qty, 0) as qty
				   from (select v.content_date
				           from con_content_history v
				           <include refid="item_history_condition"/>
				          where v.locno = #{params.locno,jdbcType=VARCHAR}
				          	<if test="null!=params.startDate and ''!=params.startDate">
									<![CDATA[
										and v.content_date >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')
									]]>
							</if>
							<if test="null!=params.endDate and ''!=params.endDate">
									<![CDATA[
										and v.content_date <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')
									]]>
							</if>
							<if test="null!=params.quality and ''!=params.quality">
								and v.quality = #{params.quality,jdbcType=VARCHAR}
							</if>
							<include refid="condition"/>
				          GROUP BY v.content_date) v1
				   left join (select to_char(v.content_date + 1, 'yyyy-mm-dd') as content_date,
				                     sum(v.qty) as qty
				                from con_content_history v
				                <include refid="item_history_condition"/>
				               where v.locno = #{params.locno,jdbcType=VARCHAR}
				                 <if test="null!=params.startDate and ''!=params.startDate">
									<![CDATA[
										and v.content_date >= to_date('${params.startDate} 00:00:00','yyyy-mm-dd hh24:mi:ss')-1
									]]>
								 </if>
								 <if test="null!=params.endDate and ''!=params.endDate">
									<![CDATA[
										and v.content_date <= to_date('${params.endDate} 23:59:59','yyyy-mm-dd hh24:mi:ss')-1
									]]>
								 </if>
								 <if test="null!=params.quality and ''!=params.quality">
										and v.quality = #{params.quality,jdbcType=VARCHAR}
								 </if>
								 <include refid="condition"/>
				               group by v.content_date) v2
				     on to_char(v1.content_date, 'yyyy-mm-dd') = v2.content_date       
			       -->    
  				  
		  		select 
		  			to_char(cc1.content_date, 'yyyy-mm-dd') select_date,
			        (select nvl(sum(v.qty), 0)
			          from con_content_history v
			          	<include refid="item_history_condition"/>
			         	where v.locno = #{params.locno,jdbcType=VARCHAR}  
			         	and to_char(v.content_date, 'yyyy-mm-dd') =
			         	    to_char(cc1.content_date - 1, 'yyyy-mm-dd')
			         	<include refid="condition_kc_qty"/>
			         	<include refid="condition"/>
			         ) as qty
			  	from (
			  			select (v.content_date) as content_date, sum(v.qty) qty
			          			from con_content_history v
			          			<include refid="item_history_condition"/>
			         			where v.locno = #{params.locno,jdbcType=VARCHAR}
			         			<include refid="condition_kc"/>
			         			<include refid="condition"/>
			    		group by v.content_date
			    ) cc1
			  
			    
			    
			    
			    union all
    			
    			<!-- 查询当天的 -->
			    select to_char(sysdate, 'yyyy-mm-dd') select_date, sum(v.qty) as qty from con_content_history v
			     	<!--  inner join item it on it.item_no = v.item_no -->
			        <include refid="item_history_condition"/>
			     	where v.locno = #{params.locno,jdbcType=VARCHAR}
			     	and to_char(sysdate,'yyyy-mm-dd') = to_char(to_date('${params.endDate}','yyyy-mm-dd'),'yyyy-mm-dd')
			     	and to_char(v.content_date,'yyyy-mm-dd') = to_char(sysdate-1,'yyyy-mm-dd')
		         	<include refid="condition_kc_qty"/>
			        <include refid="condition"/>
		    ) cch    	
		         	
		         	
	  		left join (
	  		
			  	select
					to_char(rep.select_date, 'yyyy-mm-dd') select_date,
					nvl(sum(rep.rk_crk_qty),0) rk_crk_qty,
					nvl(sum(rep.rk_cyr_qty),0) rk_cyr_qty,
					nvl(sum(rep.rk_dth_qty),0) rk_dth_qty,
					nvl(sum(rep.rk_qtrk_qty),0) rk_qtrk_qty,
					nvl(sum(rep.ck_ccd_qty),0) ck_ccd_qty,
					nvl(sum(rep.ck_cyc_qty),0) ck_cyc_qty,
					nvl(sum(rep.ck_qtck_qty),0) ck_qtck_qty,
					nvl(sum(rep.ck_kbmzh_qty),0) ck_kbmzh_qty,
					nvl(sum(rep.pd_py_qty),0) pd_py_qty,
					nvl(sum(rep.pd_pk_qty),0) pd_pk_qty,
					nvl(sum(rep.tz_kctz_qty),0) tz_kctz_qty,
					nvl(sum(rep.ydh_cr_qty),0) ydh_cr_qty,
					nvl(sum(rep.ydh_cr_box_qty),0) ydh_cr_box_qty,
					nvl(sum(rep.ydh_cyr_qty),0) ydh_cyr_qty,
					nvl(sum(rep.ydh_cyr_box_qty),0) ydh_cyr_box_qty,
					nvl(sum(rep.ydh_dtc_qty),0) ydh_dtc_qty,
					nvl(sum(rep.ydh_dtc_box_qty),0) ydh_dtc_box_qty,
					nvl(sum(rep.yswy_cr_qty),0) yswy_cr_qty,
					nvl(sum(rep.yswy_cr_box_qty),0) yswy_cr_box_qty,
					nvl(sum(rep.yswy_cyr_qty),0) yswy_cyr_qty,
					nvl(sum(rep.yswy_cyr_box_qty),0) yswy_cyr_box_qty,
					nvl(sum(rep.yswy_dtc_qty),0) yswy_dtc_qty,
					nvl(sum(rep.yswy_dtc_box_qty),0) yswy_dtc_box_qty,
					nvl(sum(rep.ysh_cr_qty),0) ysh_cr_qty,
					nvl(sum(rep.ysh_cyr_qty),0) ysh_cyr_qty,
					nvl(sum(rep.ysh_dtc_qty),0) ysh_dtc_qty
				from(
					
					<!--  
					<include refid="KC_Base_Sql" />
					union all
					-->
					<include refid="Rk_Crk_Base_Sql" />
					union all
					<include refid="Rk_Cyr_Base_Sql" />
					union all
					<include refid="Rk_Dth_Base_Sql" />
					union all
					<include refid="Rk_Qtrk_Base_Sql" />
					union all
					<include refid="Ck_Ccd_Base_Sql" />
					union all
					<include refid="Ck_Cyc_Base_Sql" />
					union all
					<include refid="Ck_Qtck_Base_Sql" />
					union all
					<include refid="Ck_Kbmzh_Base_Sql" />
					union all
					<include refid="Pd_Py_Base_Sql" />
					union all
					<include refid="Pd_Pk_Base_Sql" />
					union all
					<include refid="Tz_Kctz_Base_Sql" />
					union all
					<include refid="Ydh_Cr_Base_Sql" />
					union all
					<include refid="Ydh_Cr_Box_Base_Sql" />
					union all
					<include refid="Ydh_Cyr_Base_Sql" />
					union all
					<include refid="Ydh_Cyr_Box_Base_Sql" />
					union all
					<include refid="Ydh_Dtc_Base_Sql" />
					union all
					<include refid="Ydh_Dtc_Box_Base_Sql" />
					union all
					<include refid="Yswy_Cr_Base_Sql" />
					union all
					<include refid="Yswy_Cr_Box_Base_Sql" />
					union all
					<include refid="Yswy_Cyr_Base_Sql" />
					union all
					<include refid="Yswy_Cyr_Box_Base_Sql" />
					union all
					<include refid="Yswy_Dtc_Base_Sql" />
					union all
					<include refid="Yswy_Dtc_Box_Base_Sql" />
					union all
					<include refid="Ysh_Cr_Base_Sql" />
					union all
					<include refid="Ysh_Cyr_Base_Sql" />
					union all
					<include refid="Ysh_Dtc_Base_Sql" />
					
				)rep 
					<include refid="item_other_condition" />
				where 1=1 
					<include refid="condition" />
				group by to_char(rep.select_date, 'yyyy-mm-dd')
				
			) bd on bd.select_date = cch.select_date
				order by cch.select_date asc )x
			WHERE (nvl(x.rk_crk_qty, 0) > 0
			  OR nvl(x.rk_cyr_qty, 0) > 0
			  OR nvl(x.rk_dth_qty, 0) > 0
			  OR nvl(x.rk_qtrk_qty, 0) > 0
			  OR nvl(x.ck_ccd_qty, 0) > 0
			  OR nvl(x.ck_cyc_qty, 0) > 0
			  OR nvl(x.ck_qtck_qty, 0) > 0
			  OR nvl(x.ck_kbmzh_qty, 0) > 0
			  OR nvl(x.pd_py_qty, 0) > 0
			  OR nvl(x.pd_pk_qty, 0) > 0
			  OR nvl(x.tz_kctz_qty, 0) > 0
			  OR nvl(x.ydh_cr_qty, 0) > 0
			  OR nvl(x.ydh_cr_box_qty, 0) > 0
			  OR nvl(x.ydh_cyr_qty, 0) > 0
			  OR nvl(x.ydh_cyr_box_qty, 0) > 0
			  OR nvl(x.ydh_dtc_qty, 0) > 0
			  OR nvl(x.ydh_dtc_box_qty, 0) > 0
			  OR nvl(x.yswy_cr_qty, 0) > 0
			  OR nvl(x.yswy_cr_box_qty, 0) > 0
			  OR nvl(x.yswy_cyr_qty, 0) > 0
			  OR nvl(x.yswy_cyr_box_qty, 0) > 0
			  OR nvl(x.yswy_dtc_qty, 0) > 0
			  OR nvl(x.yswy_dtc_box_qty, 0) > 0
			  OR nvl(x.ysh_cr_qty, 0) > 0
			  OR nvl(x.ysh_cyr_qty, 0) > 0
			  OR nvl(x.ysh_dtc_qty, 0) > 0
			  OR nvl(x.qty, 0) > 0)
			  <if test="null!=params.startDate and ''!=params.startDate">
					<![CDATA[
						and x.select_date >= '${params.startDate}'
					]]>
			  </if>
			  <if test="null!=params.endDate and ''!=params.endDate">
					<![CDATA[
						and x.select_date <= '${params.endDate}'
					]]>
			  </if>
  </sql>
  
  <select id="selectSumQty" resultType="com.yougou.logistics.city.common.utils.SumUtilMap" parameterType="map">
		select 
       		nvl(sum(x.qty),0) qty,
			nvl(sum(x.rk_crk_qty),0) rk_crk_qty,
			nvl(sum(x.rk_cyr_qty),0) rk_cyr_qty,
			nvl(sum(x.rk_dth_qty),0) rk_dth_qty,
			nvl(sum(x.rk_qtrk_qty),0) rk_qtrk_qty,
			nvl(sum(x.ck_ccd_qty),0) ck_ccd_qty,
			nvl(sum(x.ck_cyc_qty),0) ck_cyc_qty,
			nvl(sum(x.ck_qtck_qty),0) ck_qtck_qty,
			nvl(sum(x.ck_kbmzh_qty),0) ck_kbmzh_qty,
			nvl(sum(x.pd_py_qty),0) pd_py_qty,
			nvl(sum(x.pd_pk_qty),0) pd_pk_qty,
			nvl(sum(x.tz_kctz_qty),0) tz_kctz_qty,
			nvl(sum(x.ydh_cr_qty),0) ydh_cr_qty,
			nvl(sum(x.ydh_cr_box_qty),0) ydh_cr_box_qty,
			nvl(sum(x.ydh_cyr_qty),0) ydh_cyr_qty,
			nvl(sum(x.ydh_cyr_box_qty),0) ydh_cyr_box_qty,
			nvl(sum(x.ydh_dtc_qty),0) ydh_dtc_qty,
			nvl(sum(x.ydh_dtc_box_qty),0) ydh_dtc_box_qty,
			nvl(sum(x.yswy_cr_qty),0) yswy_cr_qty,
			nvl(sum(x.yswy_cr_box_qty),0) yswy_cr_box_qty,
			nvl(sum(x.yswy_cyr_qty),0) yswy_cyr_qty,
			nvl(sum(x.yswy_cyr_box_qty),0) yswy_cyr_box_qty,
			nvl(sum(x.yswy_dtc_qty),0) yswy_dtc_qty,
			nvl(sum(x.yswy_dtc_box_qty),0) yswy_dtc_box_qty,
			nvl(sum(x.ysh_cr_qty),0) ysh_cr_qty,
			nvl(sum(x.ysh_cyr_qty),0) ysh_cyr_qty,
			nvl(sum(x.ysh_dtc_qty),0) ysh_dtc_qty
        from (<include refid="Base_Sql" />) x
  </select>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!--优化后的代码，现在用这些代码-->
  
  <select id="selectAllConContentHistory" resultMap="BaseResultMap" parameterType="map">
  		select cch.select_date,nvl(cch.qty,0) from(
  
			select to_char(v.content_date,'yyyy-mm-dd') as select_date, sum(v.qty) qty
				from con_content_history v
				<include refid="item_history_condition" />
				where v.locno = #{params.locno,jdbcType=VARCHAR}
				<include refid="condition_kc" />
				<include refid="condition" />
				group by v.content_date
				
			union all
			
			<!-- 查询当天的 -->
			select to_char(sysdate, 'yyyy-mm-dd') select_date, sum(v.qty) as qty from con_content_history v
				<include refid="item_history_condition"/>
				 where v.locno = #{params.locno,jdbcType=VARCHAR}
				 and to_char(sysdate,'yyyy-mm-dd') = to_char(to_date('${params.endDate}','yyyy-mm-dd'),'yyyy-mm-dd')
				 and to_char(v.content_date,'yyyy-mm-dd') = to_char(sysdate-1,'yyyy-mm-dd')
			    <include refid="condition_kc_qty"/>
				<include refid="condition"/>
				
		)cch order by cch.select_date asc
  </select>
  
  <select id="selectConContentHistoryCountByDate" resultType="java.lang.Integer">
	select nvl(sum(v.qty), 0)
		from con_content_history v
		<include refid="item_history_condition" />
		where v.locno = #{params.locno,jdbcType=VARCHAR}
		and v.content_date = #{params.selectDate,jdbcType=TIMESTAMP}
		<include refid="condition_kc_qty" />
		<include refid="condition" />
  </select>
  
  <select id="selectConContentHistoryByDate" resultMap="BaseResultMap" parameterType="map">
  	 select v.content_date+1 as select_date, sum(v.qty) as qty
     	from con_content_history v
        <include refid="item_history_condition" />
         where v.locno = #{params.locno,jdbcType=VARCHAR}
         <if test="null!=params.startDate and ''!=params.startDate">
				<![CDATA[
					AND v.content_date >=to_date('${params.startDate} 00:00:00', 'yyyy-mm-dd hh24:mi:ss') - 1
				]]>
		</if>
		<if test="null!=params.endDate and ''!=params.endDate">
				<![CDATA[
					AND v.content_date <=to_date('${params.endDate} 23:59:59', 'yyyy-mm-dd hh24:mi:ss') - 1
				]]>
		</if>
		<include refid="condition_kc_qty" />
		<include refid="condition" />
        group by v.content_date
  </select>
  
  <select id="selectBillDetailByDate" resultMap="BaseResultMap" parameterType="map">
  
    select xx.select_date,
       nvl(sum(xx.rk_crk_qty), 0) rk_crk_qty,
       nvl(sum(xx.rk_cyr_qty), 0) rk_cyr_qty,
       nvl(sum(xx.rk_dth_qty), 0) rk_dth_qty,
       nvl(sum(xx.rk_qtrk_qty), 0) rk_qtrk_qty,
       nvl(sum(xx.rk_cytz_qty), 0) rk_cytz_qty,
       nvl(sum(xx.ck_ccd_qty), 0) ck_ccd_qty,
       nvl(sum(xx.ck_cyc_qty), 0) ck_cyc_qty,
       nvl(sum(xx.ck_qtck_qty), 0) ck_qtck_qty,
       nvl(sum(xx.ck_kbmzh_qty), 0) ck_kbmzh_qty,
       nvl(sum(xx.ck_cytz_qty), 0) ck_cytz_qty,
       nvl(sum(xx.pd_py_qty), 0) pd_py_qty,
       nvl(sum(xx.pd_pk_qty), 0) pd_pk_qty,
       nvl(sum(xx.tz_kctz_qty), 0) tz_kctz_qty,
       nvl(sum(xx.tz_kctz_type_qty), 0) tz_kctz_type_qty,
       nvl(sum(xx.tz_kctz_calc_qty), 0) tz_kctz_calc_qty,
       nvl(sum(xx.ydh_cr_qty), 0) ydh_cr_qty,
       nvl(sum(xx.ydh_cr_box_qty), 0) ydh_cr_box_qty,
       nvl(sum(xx.ydh_cyr_qty), 0) ydh_cyr_qty,
       nvl(sum(xx.ydh_cyr_box_qty), 0) ydh_cyr_box_qty,
       nvl(sum(xx.ydh_dtc_qty), 0) ydh_dtc_qty,
       nvl(sum(xx.ydh_dtc_box_qty), 0) ydh_dtc_box_qty,
       nvl(sum(xx.yswy_cr_qty), 0) yswy_cr_qty,
       nvl(sum(xx.yswy_cr_box_qty), 0) yswy_cr_box_qty,
       nvl(sum(xx.yswy_cyr_qty), 0) yswy_cyr_qty,
       nvl(sum(xx.yswy_cyr_box_qty), 0) yswy_cyr_box_qty,
       nvl(sum(xx.yswy_dtc_qty), 0) yswy_dtc_qty,
       nvl(sum(xx.yswy_dtc_box_qty), 0) yswy_dtc_box_qty,
       nvl(sum(xx.ysh_cr_qty), 0) ysh_cr_qty,
       nvl(sum(xx.ysh_cr_box_qty), 0) ysh_cr_box_qty,
       nvl(sum(xx.ysh_cyr_qty), 0) ysh_cyr_qty,
       nvl(sum(xx.ysh_cyr_box_qty), 0) ysh_cyr_box_qty,
       nvl(sum(xx.ysh_dtc_qty), 0) ysh_dtc_qty,
       nvl(sum(xx.ysh_dtc_box_qty), 0) ysh_dtc_box_qty
  from (
  
	select
		to_char(rep.select_date, 'yyyy-mm-dd') select_date,
		nvl(sum(rep.rk_crk_qty),0) rk_crk_qty,
		nvl(sum(rep.rk_cyr_qty),0) rk_cyr_qty,
		nvl(sum(rep.rk_dth_qty),0) rk_dth_qty,
		nvl(sum(rep.rk_qtrk_qty),0) rk_qtrk_qty,
		nvl(sum(rep.rk_cytz_qty),0) rk_cytz_qty,
		nvl(sum(rep.ck_ccd_qty),0) ck_ccd_qty,
		nvl(sum(rep.ck_cyc_qty),0) ck_cyc_qty,
		nvl(sum(rep.ck_qtck_qty),0) ck_qtck_qty,
		nvl(sum(rep.ck_kbmzh_qty),0) ck_kbmzh_qty,
		nvl(sum(rep.ck_cytz_qty),0) ck_cytz_qty,
		<!--  
		nvl(sum(rep.pd_py_qty),0) pd_py_qty,
		nvl(sum(rep.pd_pk_qty),0) pd_pk_qty,
		-->
		(case when nvl(sum(rep.pd_pk_qty), 0) + nvl(sum(rep.pd_py_qty), 0) > 0 then nvl(sum(rep.pd_pk_qty), 0) + nvl(sum(rep.pd_py_qty), 0) else 0 end) pd_py_qty,
		(case when nvl(sum(rep.pd_pk_qty), 0) + nvl(sum(rep.pd_py_qty), 0)&lt;0 then nvl(sum(rep.pd_pk_qty), 0) + nvl(sum(rep.pd_py_qty), 0) else 0 end) pd_pk_qty,
		nvl(sum(rep.tz_kctz_qty),0) tz_kctz_qty,
		nvl(sum(rep.tz_kctz_type_qty),0) tz_kctz_type_qty,
		nvl(sum(rep.tz_kctz_calc_qty),0) tz_kctz_calc_qty,
		nvl(sum(rep.ydh_cr_qty),0) ydh_cr_qty,
		nvl(sum(rep.ydh_cr_box_qty),0) ydh_cr_box_qty,
		nvl(sum(rep.ydh_cyr_qty),0) ydh_cyr_qty,
		nvl(sum(rep.ydh_cyr_box_qty),0) ydh_cyr_box_qty,
		nvl(sum(rep.ydh_dtc_qty),0) ydh_dtc_qty,
		nvl(sum(rep.ydh_dtc_box_qty),0) ydh_dtc_box_qty,
		0 yswy_cr_qty,
		nvl(sum(rep.yswy_cr_box_qty),0) yswy_cr_box_qty,
		0 yswy_cyr_qty,
		nvl(sum(rep.yswy_cyr_box_qty),0) yswy_cyr_box_qty,
		0 yswy_dtc_qty,
		nvl(sum(rep.yswy_dtc_box_qty),0) yswy_dtc_box_qty,
		nvl(sum(rep.ysh_cr_qty),0) ysh_cr_qty,
		nvl(sum(rep.ysh_cr_box_qty),0) ysh_cr_box_qty,
		nvl(sum(rep.ysh_cyr_qty),0) ysh_cyr_qty,
		nvl(sum(rep.ysh_cyr_box_qty),0) ysh_cyr_box_qty,
		nvl(sum(rep.ysh_dtc_qty),0) ysh_dtc_qty,
		nvl(sum(rep.ysh_dtc_box_qty), 0) ysh_dtc_box_qty
		from(
		 	select 
		 	 	v.locno,
		      	v.select_date,
		      	v.item_no,
		      	v.quality,
		      	v.rk_crk_qty,
		      	v.rk_cyr_qty,
		      	v.rk_dth_qty,
		      	v.rk_qtrk_qty,
		      	v.rk_cytz_qty, 
		      	v.ck_ccd_qty,
		      	v.ck_cyc_qty,
		      	v.ck_qtck_qty,
		      	v.ck_kbmzh_qty,
		      	v.ck_cytz_qty, 
		      	v.pd_py_qty,
		      	v.pd_pk_qty,
		      	v.tz_kctz_qty,
		      	v.tz_kctz_type_qty,
		      	v.tz_kctz_calc_qty,
		      	v.ydh_cr_qty,
		      	v.ydh_cr_box_qty,
		      	v.ydh_cyr_qty,
		      	v.ydh_cyr_box_qty,
		      	v.ydh_dtc_qty,
		      	v.ydh_dtc_box_qty,
		      	v.yswy_cr_qty,
		      	v.yswy_cr_box_qty,
		      	v.yswy_cyr_qty,
		      	v.yswy_cyr_box_qty,
		      	v.yswy_dtc_qty,
		      	v.yswy_dtc_box_qty,
		      	v.ysh_cr_qty,
		      	v.ysh_cr_box_qty,
		      	v.ysh_cyr_qty,
		      	v.ysh_cyr_box_qty,
		      	v.ysh_dtc_qty,
		      	v.ysh_dtc_box_qty
		 	from V_SPLIT_DEPOT_DATA_SUM_REPORT v
		 	where 1=1
		 	<include refid="condition_view"/>
		)rep
		<include refid="item_other_condition" />
		where 1=1
		<include refid="condition" />
		group by to_char(rep.select_date, 'yyyy-mm-dd')
		
		union all
		<!-- 已收未验的 -->
		<include refid="selectYswyBillSumSql"/>
		)xx group by xx.select_date
  </select>
  
  
  <sql id="selectYswyBillSumSql">
  	select
		x.select_date,
		0 as rk_crk_qty,
		0 as rk_cyr_qty,
		0 as rk_dth_qty,
		0 as rk_qtrk_qty,
		0 as rk_cytz_qty,
		0 as ck_ccd_qty,
		0 as ck_cyc_qty,
		0 as ck_qtck_qty,
		0 as ck_kbmzh_qty,
		0 as ck_cytz_qty,
		0 as pd_py_qty,
		0 as pd_pk_qty,
		0 as tz_kctz_qty,
		0 as tz_kctz_type_qty,
		0 as tz_kctz_calc_qty,
		0 as ydh_cr_qty,
		0 as ydh_cr_box_qty,
		0 as ydh_cyr_qty,
		0 as ydh_cyr_box_qty,
		0 as ydh_dtc_qty,
		0 as ydh_dtc_box_qty,
		nvl(sum(x.yswy_cr_qty),0) yswy_cr_qty,
		0 as yswy_cr_box_qty,
		nvl(sum(x.yswy_cyr_qty),0) yswy_cyr_qty,
		0 as yswy_cyr_box_qty,
		nvl(sum(x.yswy_dtc_qty),0) yswy_dtc_qty,
		0 as yswy_dtc_box_qty,
		0 as ysh_cr_qty,
		0 as ysh_cr_box_qty,
		0 as ysh_cyr_qty,
		0 as ysh_cyr_box_qty,
		0 as ysh_dtc_qty,
		0 as ysh_dtc_box_qty
		from(
			select 
				rep.select_date,
				rep.receipt_no,
				<!-- 
				0 as rk_crk_qty,
				0 as rk_cyr_qty,
				0 as rk_dth_qty,
				0 as rk_qtrk_qty,
				0 as ck_ccd_qty,
				0 as ck_cyc_qty,
				0 as ck_qtck_qty,
				0 as ck_kbmzh_qty,
				0 as pd_py_qty,
				0 as pd_pk_qty,
				0 as tz_kctz_qty,
				0 as tz_kctz_calc_qty,
				0 as ydh_cr_qty,
				0 as ydh_cr_box_qty,
				0 as ydh_cyr_qty,
				0 as ydh_cyr_box_qty,
				0 as ydh_dtc_qty,
				0 as ydh_dtc_box_qty, -->
				case when (nvl(sum(rep.cr_receipt_qty),0)-nvl(sum(rep.cr_check_qty),0)) &lt;= 0 then 0 else (nvl(sum(rep.cr_receipt_qty),0)-nvl(sum(rep.cr_check_qty),0)) end yswy_cr_qty,
				<!-- 0 as yswy_cr_box_qty,-->
				case when (nvl(sum(rep.cyr_receipt_qty),0)-nvl(sum(rep.cyr_check_qty),0)) &lt;= 0 then 0 else (nvl(sum(rep.cyr_receipt_qty),0)-nvl(sum(rep.cyr_check_qty),0)) end yswy_cyr_qty,
				<!-- 0 as yswy_cyr_box_qty,-->
				case when (nvl(sum(rep.dtc_receipt_qty),0)-nvl(sum(rep.dtc_check_qty),0)) &lt;= 0 then 0 else (nvl(sum(rep.dtc_receipt_qty),0)-nvl(sum(rep.dtc_check_qty),0)) end yswy_dtc_qty
				<!-- 0 as yswy_dtc_box_qty,
				0 as ysh_cr_qty,
				0 as ysh_cyr_qty,
				0 as ysh_dtc_qty-->
			 from (
				<include refid="Yswy_Cr_Base_Sql_Join"/>
				union all
				<include refid="Yswy_Cyr_Base_Sql_Join"/>
				union all
				<include refid="Yswy_Dtc_Base_Sql_Join"/>
			)rep  
			<include refid="item_other_condition"/>
			where 1=1
			<include refid="condition" />
			group by rep.select_date,rep.receipt_no
		)x group by x.select_date
  </sql>
  
  
  <!-- 已收未验  厂入sql -->
  <sql id="Yswy_Cr_Base_Sql_Join" >
  		select 
			to_char(ir.audittm, 'yyyy-mm-dd') as select_date,
			ir.receipt_no,
			ird.item_no,
			sum(nvl(ird.receipt_qty,0)) cr_receipt_qty,
			sum(nvl(ird.check_qty,0)) cr_check_qty,
			0 as cyr_receipt_qty,
			0 as cyr_check_qty,
			0 as dtc_receipt_qty,
			0 as dtc_check_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '0')
		group by to_char(ir.audittm, 'yyyy-mm-dd'),ir.receipt_no,ird.item_no
  </sql>
  
  <!-- 已收未验  仓移入sql -->
  <sql id="Yswy_Cyr_Base_Sql_Join" >
  		select 
			to_char(ir.audittm, 'yyyy-mm-dd') as select_date,
			ir.receipt_no,
			ird.item_no,
			0 as cr_receipt_qty,
			0 as cr_check_qty,
			sum(nvl(ird.receipt_qty,0)) cyr_receipt_qty,
			sum(nvl(ird.check_qty,0)) cyr_check_qty,
			0 as dtc_receipt_qty,
			0 as dtc_check_qty
			  from bill_im_receipt ir
			 inner join bill_im_receipt_dtl ird
			    on ir.locno = ird.locno
			   and ir.owner_no = ird.owner_no
			   and ir.receipt_no = ird.receipt_no
			 where ir.status != '10'
			   and ir.locno = #{params.locno,jdbcType=VARCHAR}
			   and ir.business_type = '0'
			   <include refid="condition_im_receipt" />
			   and exists (select 'X'
			          from bill_im_import ii
			         where ii.status != '10'
			           and ii.locno = ird.locno
			           and ii.owner_no = ird.owner_no
			           and ii.import_no = ird.import_no
			           and ii.business_type = '4')
		group by to_char(ir.audittm, 'yyyy-mm-dd'),ir.receipt_no,ird.item_no
  </sql>
  
   <!-- 已收未验  店退仓sql -->
  <sql id="Yswy_Dtc_Base_Sql_Join" >
  		select 
			to_char(ur.audittm, 'yyyy-mm-dd') as select_date,
			ur.receipt_no,
			uud.item_no,
			0 as cr_receipt_qty,
			0 as cr_check_qty,
			0 as cyr_receipt_qty,
			0 as cyr_check_qty,
			sum(nvl(uud.receipt_qty,0)) dtc_receipt_qty,
			sum(nvl(uud.check_qty,0)) dtc_check_qty
			  from bill_um_untread uu
			 inner join bill_um_untread_dtl uud
			    on uu.locno = uud.locno
			   and uu.owner_no = uud.owner_no
			   and uu.untread_no = uud.untread_no
			 inner join bill_um_receipt ur
			    on ur.locno = uu.locno
			    and ur.owner_no = uu.owner_no
			    and ur.untread_no = uu.untread_no
			 where ur.status != '10'
			   and uu.locno = #{params.locno,jdbcType=VARCHAR}
			   <include refid="condition_uu_receipt" />
		group by to_char(ur.audittm, 'yyyy-mm-dd'),ur.receipt_no,uud.item_no
  </sql>
  
</mapper>